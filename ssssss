--[[
    Roblox Smart Trade Trigger Script (Luau) - Web-Based Control
    ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£ trade
    
    ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö:
    - 1: Stop Trade
    - 2: Start Trade  
    - 3: Shutdown Game
    
    ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:
    1. ‡πÄ‡∏õ‡∏¥‡∏î Roblox Executor
    2. Copy ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á
    3. ‡∏Å‡∏î Execute
    4. ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏à‡∏∞‡∏£‡∏≠‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡πá‡∏ö
]]

-- Configuration
local CHECK_INTERVAL = 5 -- ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
local WEB_API_URL = "http://199.21.172.211:3001/api/trade-command" -- URL ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö API
local MIN_COINS_THRESHOLD = 5000 -- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô trade start

-- Player Configuration (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
local PLAYER_ID = "Player1" -- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô ID ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
local PLAYER_USERNAME = "YourUsername" -- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô username ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

-- Place IDs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ join
local TRADE_START_PLACE_ID = 14119723130
local TRADE_STOP_PLACE_ID = 5233782396

-- Loadstring URLs
local TRADE_START_LOADSTRING = "https://raw.githubusercontent.com/WeerapongCu/hiNew/refs/heads/main/brbrbr"
local TRADE_STOP_LOADSTRING = "https://api.luarmor.net/files/v3/loaders/008bf699b44dd5a7d35d683c3e0805aa.lua"

-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
local last_action_time = 0
local ACTION_COOLDOWN = 10 -- ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ã‡πâ‡∏≥‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ)
local last_command = 0 -- ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
local is_running = true -- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå

-- ‡πÉ‡∏ä‡πâ HttpService ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö decode JSON
local HttpService = game:GetService("HttpService")

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô request ‡∏Ç‡∏≠‡∏á executor
local requestFunction = (syn and syn.request) or (http and http.request) or request
if not requestFunction then
    warn("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô request ‡πÉ‡∏ô executor ‡∏ô‡∏µ‡πâ!")
    return
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô console
local function printToConsole(message)
    print("[" .. os.date("%H:%M:%S") .. "] " .. message)
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ place id ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
local function getCurrentPlaceId()
    local success, result = pcall(function()
        return game.PlaceId
    end)
    if success then
        return result
    else
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡πá‡∏Ñ place id ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡πâ: " .. tostring(result))
        return nil
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
local function getCurrentCoins()
    local success, result = pcall(function()
        local players = game:GetService("Players")
        local current_place_id = getCurrentPlaceId()
        
        -- ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Trade Start Place ‡πÉ‡∏ä‡πâ LocalPlayer.Data.Coins.Value
        if current_place_id == TRADE_START_PLACE_ID then
            local coins = players.LocalPlayer.Data.Coins.Value
            return coins
        else
            -- ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Place ‡∏≠‡∏∑‡πà‡∏ô ‡πÉ‡∏ä‡πâ LocalPlayer.PlayerGui.Data.Coins.Value
            local coins = players.LocalPlayer.PlayerGui.Data.Coins.Value
            return coins
        end
    end)
    
    if success and result then
        return result
    else
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏î‡πâ: " .. tostring(result))
        return nil
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á request ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ß‡πá‡∏ö API (Multi Player)
local function getTradeCommand()
    local success, result = pcall(function()
        local response = requestFunction({
            Url = WEB_API_URL .. "/" .. PLAYER_ID,
            Method = 'GET',
            Headers = {
                ['User-Agent'] = 'Roblox-Trade-Control-Script/1.0',
                ['Accept'] = 'application/json',
            },
        })
        
        if response and response.StatusCode == 200 then
            local data = HttpService:JSONDecode(response.Body)
            return data.command
        else
            error('HTTP request failed or status not 200')
        end
    end)
    
    if success then
        return result
    else
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏î‡πâ: " .. tostring(result))
        return 0 -- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ß‡πá‡∏ö (Multi Player)
local function sendStatus(status, message)
    local success, result = pcall(function()
        local data = {
            status = status,
            message = message,
            timestamp = os.time(),
            place_id = getCurrentPlaceId(),
            coins = getCurrentCoins(),
            username = PLAYER_USERNAME
        }
        
        local json_data = HttpService:JSONEncode(data)
        local response = requestFunction({
            Url = WEB_API_URL .. "/" .. PLAYER_ID .. "/status",
            Method = 'POST',
            Headers = {
                ['User-Agent'] = 'Roblox-Trade-Control-Script/1.0',
                ['Content-Type'] = 'application/json',
                ['Accept'] = 'application/json',
            },
            Body = json_data
        })
        
        if not response or response.StatusCode ~= 200 then
            error('Failed to send status')
        end
    end)
    
    if not success then
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏î‡πâ: " .. tostring(result))
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö join place
local function joinPlace(placeId, reason)
    local success, result = pcall(function()
        printToConsole("üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á join place ID: " .. placeId .. " (" .. reason .. ")")
        local TeleportService = game:GetService("TeleportService")
        TeleportService:Teleport(placeId)
        printToConsole("‚úÖ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£ join place ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
    end)
    if not success then
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ join place ‡πÑ‡∏î‡πâ: " .. tostring(result))
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö place 14119723130)
local function warpToPosition()
    local success, result = pcall(function()
        local player = game.Players.LocalPlayer
        local character = player.Character
        if character then
            printToConsole("üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î...")
            character:PivotTo(CFrame.new(Vector3.new(-2132.24, 490.66, 1106.83)))
            printToConsole("‚úÖ ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (-2132.24, 490.66, 1106.83)")
        else
            printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö Character ‡∏Ç‡∏≠‡∏á LocalPlayer")
        end
    end)
    if not success then
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÑ‡∏î‡πâ: " .. tostring(result))
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏±‡∏ô Trade Start Script
local function runTradeStartScript()
    local success, result = pcall(function()
        printToConsole("üìú ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ô Trade Start Script...")
        loadstring(game:HttpGet(TRADE_START_LOADSTRING))()
        printToConsole("‚úÖ ‡∏£‡∏±‡∏ô Trade Start Script ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
    end)
    if not success then
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ô Trade Start Script ‡πÑ‡∏î‡πâ: " .. tostring(result))
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏±‡∏ô Trade Stop Script
local function runTradeStopScript()
    local success, result = pcall(function()
        printToConsole("üìú ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ô Trade Stop Script...")
        loadstring(game:HttpGet(TRADE_STOP_LOADSTRING))()
        printToConsole("‚úÖ ‡∏£‡∏±‡∏ô Trade Stop Script ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
    end)
    if not success then
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ô Trade Stop Script ‡πÑ‡∏î‡πâ: " .. tostring(result))
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î‡πÄ‡∏Å‡∏°
local function shutdownGame()
    local success, result = pcall(function()
        printToConsole("üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î‡πÄ‡∏Å‡∏°...")
        game:Shutdown()
    end)
    if not success then
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏¥‡∏î‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ: " .. tostring(result))
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
local function processCommand(command)
    local success, error_msg = pcall(function()
        local current_place_id = getCurrentPlaceId()
        local now = tick()
        
        if command == 1 then
            -- Stop Trade
            printToConsole("üõë ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á: Stop Trade")
            
            if current_place_id == TRADE_STOP_PLACE_ID then
                -- ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Trade Stop Place ‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏±‡∏ô script
                if now - last_action_time > ACTION_COOLDOWN then
                    runTradeStopScript()
                    last_action_time = now
                    sendStatus("success", "Stop Trade Script ‡∏£‡∏±‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
                else
                    printToConsole("‚è≥ Cooldown: ‡∏£‡∏≠ " .. math.ceil(ACTION_COOLDOWN - (now - last_action_time)) .. " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
                    sendStatus("cooldown", "‡∏£‡∏≠ cooldown")
                end
            else
                -- ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Trade Stop Place ‡πÉ‡∏´‡πâ join ‡πÑ‡∏õ
                if now - last_action_time > ACTION_COOLDOWN then
                    printToConsole("üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏õ Trade Stop Place")
                    joinPlace(TRADE_STOP_PLACE_ID, "Trade Stop")
                    last_action_time = now
                    sendStatus("joining", "‡∏Å‡∏≥‡∏•‡∏±‡∏á join Trade Stop Place")
                else
                    printToConsole("‚è≥ Cooldown: ‡∏£‡∏≠ " .. math.ceil(ACTION_COOLDOWN - (now - last_action_time)) .. " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
                    sendStatus("cooldown", "‡∏£‡∏≠ cooldown")
                end
            end
            
        elseif command == 2 then
            -- Start Trade
            printToConsole("‚ñ∂Ô∏è ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á: Start Trade")
            
            local coins = getCurrentCoins()
            if not coins then
                printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏î‡πâ")
                sendStatus("error", "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏î‡πâ")
                return
            end
            
            if coins <= MIN_COINS_THRESHOLD then
                printToConsole("‚ùå ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠: " .. coins .. " ‚â§ " .. MIN_COINS_THRESHOLD)
                sendStatus("error", "‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠: " .. coins .. " ‚â§ " .. MIN_COINS_THRESHOLD)
                return
            end
            
            if current_place_id == TRADE_START_PLACE_ID then
                -- ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Trade Start Place ‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏±‡∏ô script ‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏£‡πå‡∏õ
                if now - last_action_time > ACTION_COOLDOWN then
                    runTradeStartScript()
                    warpToPosition()
                    last_action_time = now
                    sendStatus("success", "Start Trade Script ‡∏£‡∏±‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç: " .. coins .. ")")
                else
                    printToConsole("‚è≥ Cooldown: ‡∏£‡∏≠ " .. math.ceil(ACTION_COOLDOWN - (now - last_action_time)) .. " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
                    sendStatus("cooldown", "‡∏£‡∏≠ cooldown")
                end
            else
                -- ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Trade Start Place ‡πÉ‡∏´‡πâ join ‡πÑ‡∏õ
                if now - last_action_time > ACTION_COOLDOWN then
                    printToConsole("üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏õ Trade Start Place")
                    joinPlace(TRADE_START_PLACE_ID, "Trade Start - ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç " .. tostring(coins))
                    last_action_time = now
                    sendStatus("joining", "‡∏Å‡∏≥‡∏•‡∏±‡∏á join Trade Start Place (‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç: " .. coins .. ")")
                else
                    printToConsole("‚è≥ Cooldown: ‡∏£‡∏≠ " .. math.ceil(ACTION_COOLDOWN - (now - last_action_time)) .. " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
                    sendStatus("cooldown", "‡∏£‡∏≠ cooldown")
                end
            end
            
        elseif command == 3 then
            -- Shutdown Game
            printToConsole("üîÑ ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á: Shutdown Game")
            sendStatus("shutdown", "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î‡πÄ‡∏Å‡∏°")
            shutdownGame()
            
        else
            -- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
            if command ~= 0 then
                printToConsole("‚ùì ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: " .. tostring(command))
                sendStatus("error", "‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: " .. tostring(command))
            end
        end
        
        -- ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        local coin_status = ""
        local coins = getCurrentCoins()
        if coins then
            coin_status = " | ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç: " .. coins .. "/" .. MIN_COINS_THRESHOLD
        end
        
        printToConsole("üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: Place ID " .. tostring(current_place_id) .. coin_status)
        printToConsole("----------------------------------------")
    end)
    
    if not success then
        printToConsole("‚ùå [ERROR] Error in processCommand: " .. tostring(error_msg))
        sendStatus("error", "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " .. tostring(error_msg))
    end
end

-- Main Loop
local function mainLoop()
    local success, error_msg = pcall(function()
        printToConsole("üöÄ Roblox Multi-Player Trade Script Started!")
        printToConsole("üë§ Player ID: " .. PLAYER_ID)
        printToConsole("üë§ Username: " .. PLAYER_USERNAME)
        printToConsole("üåê Web API URL: " .. WEB_API_URL .. "/" .. PLAYER_ID)
        printToConsole("‚è±Ô∏è  Check interval: " .. CHECK_INTERVAL .. " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
        printToConsole("üïê Action Cooldown: " .. ACTION_COOLDOWN .. " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
        printToConsole("")
        printToConsole("üéØ ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö:")
        printToConsole("   1: Stop Trade ‚Üí Place ID: " .. TRADE_STOP_PLACE_ID)
        printToConsole("   2: Start Trade ‚Üí Place ID: " .. TRADE_START_PLACE_ID .. " (‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç > " .. MIN_COINS_THRESHOLD .. ")")
        printToConsole("   3: Shutdown Game")
        printToConsole("")
        printToConsole("üí° ‡∏£‡∏∞‡∏ö‡∏ö Smart (Multi Player):")
        printToConsole("   - ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡∏ó‡∏∏‡∏Å " .. CHECK_INTERVAL .. " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
        printToConsole("   - ‡πÄ‡∏ä‡πá‡∏Ñ place id ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô join")
        printToConsole("   - ‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏±‡∏ô Trade Start")
        printToConsole("   - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ã‡πâ‡∏≥‡∏î‡πâ‡∏ß‡∏¢ cooldown")
        printToConsole("   - ‡∏™‡πà‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ß‡πá‡∏ö")
        printToConsole("   - ‡∏£‡∏±‡∏ô loadstring ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥")
        printToConsole("   - ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô Trade Start Place")
        printToConsole("   - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢ Player ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô")
        printToConsole("")
        printToConsole("üõ°Ô∏è  ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô:")
        printToConsole("   - ‡πÉ‡∏ä‡πâ pcall ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô")
        printToConsole("   - Cooldown " .. ACTION_COOLDOWN .. " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ã‡πâ‡∏≥")
        printToConsole("   - ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô console ‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô")
        printToConsole("   - ‡∏™‡πà‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ß‡πá‡∏ö")
        printToConsole("   - ‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ï‡∏≤‡∏° Player ID")
        printToConsole("----------------------------------------")
        
        -- ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        local current_place_id = getCurrentPlaceId()
        local coins = getCurrentCoins()
        printToConsole("üìç Place ID ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: " .. tostring(current_place_id))
        if coins then
            printToConsole("üí∞ ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: " .. tostring(coins))
        end
        printToConsole("üü¢ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡πá‡∏ö...")
        printToConsole("----------------------------------------")
        
        -- ‡∏™‡πà‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ß‡πá‡∏ö
        sendStatus("ready", "‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á")
        
        -- Main loop
        while is_running do
            local loop_success, loop_error = pcall(function()
                -- ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡πá‡∏ö
                local command = getTradeCommand()
                
                -- ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡∏°‡πà
                if command ~= last_command and command ~= 0 then
                    last_command = command
                    processCommand(command)
                end
                
                wait(CHECK_INTERVAL)
            end)
            
            if not loop_success then
                printToConsole("‚ùå [ERROR] Error in main loop: " .. tostring(loop_error))
                sendStatus("error", "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô main loop: " .. tostring(loop_error))
                printToConsole("üîÑ Restarting loop in 5 seconds...")
                wait(5)
            end
        end
    end)
    
    if not success then
        printToConsole("‚ùå [CRITICAL ERROR] Script failed to start: " .. tostring(error_msg))
        sendStatus("error", "‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÑ‡∏î‡πâ: " .. tostring(error_msg))
    end
end

-- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå
mainLoop() 
