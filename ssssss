--[[
    Roblox Smart Trade Trigger Script (Luau) - Web-Based Control with Coroutines
    ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£ trade ‡πÅ‡∏ö‡∏ö‡πÅ‡∏¢‡∏Å coroutines
    
    ‡∏ô‡∏≤‡∏¢ A: ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô script (1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
    ‡∏ô‡∏≤‡∏¢ B: ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏¢‡πâ‡∏≤‡∏¢ place (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á)
    
    ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö:
    - 1: Stop Trade
    - 2: Start Trade  
    - 3: Shutdown Game
    
    ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:
    1. ‡πÄ‡∏õ‡∏¥‡∏î Roblox Executor
    2. Copy ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á
    3. ‡∏Å‡∏î Execute
    4. ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏à‡∏∞‡∏£‡∏≠‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡πá‡∏ö
]]

-- Configuration
local CHECK_INTERVAL = 5 -- ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
local WEB_API_URL = "http://199.21.172.211:3001/api/trade-command" -- URL ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö API
local MIN_COINS_THRESHOLD = 3000 -- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô trade start

-- Place IDs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ join
local TRADE_START_PLACE_ID = 14119723130
local TRADE_STOP_PLACE_ID = 5233782396

-- Loadstring URLs
local TRADE_START_LOADSTRING = "https://raw.githubusercontent.com/WeerapongCu/hiNew/refs/heads/main/brbrbr"
local TRADE_STOP_LOADSTRING = "https://api.luarmor.net/files/v3/loaders/008bf699b44dd5a7d35d683c3e0805aa.lua"

-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
local last_action_time = 0
local ACTION_COOLDOWN = 10 -- ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ã‡πâ‡∏≥‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ)
local last_command = 1 -- ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (default = 1 = Stop Trade)
local is_running = true -- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå

-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö coroutines
local script_run_flags = {
    start_trade_ran = false,  -- ‡∏ô‡∏≤‡∏¢ A ‡∏£‡∏±‡∏ô start trade script ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
    stop_trade_ran = false    -- ‡∏ô‡∏≤‡∏¢ A ‡∏£‡∏±‡∏ô stop trade script ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
}

-- ‡πÉ‡∏ä‡πâ HttpService ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö decode JSON
local HttpService = game:GetService("HttpService")

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô request ‡∏Ç‡∏≠‡∏á executor
local requestFunction = (syn and syn.request) or (http and http.request) or request
if not requestFunction then
    warn("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô request ‡πÉ‡∏ô executor ‡∏ô‡∏µ‡πâ!")
    return
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô console
local function printToConsole(message)
    print("[" .. os.date("%H:%M:%S") .. "] " .. message)
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ place id ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
local function getCurrentPlaceId()
    local success, result = pcall(function()
        return game.PlaceId
    end)
    if success then
        return result
    else
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡πá‡∏Ñ place id ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡πâ: " .. tostring(result))
        return nil
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
local function getCurrentCoins()
    local success, result = pcall(function()
        local players = game:GetService("Players")
        local current_place_id = getCurrentPlaceId()
        
        -- ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Trade Start Place ‡πÉ‡∏ä‡πâ LocalPlayer.Data.Coins.Value
        if current_place_id == TRADE_START_PLACE_ID then
            local coins = players.LocalPlayer.Data.Coins.Value
            return coins
        else
            -- ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Place ‡∏≠‡∏∑‡πà‡∏ô ‡πÉ‡∏ä‡πâ LocalPlayer.PlayerGui.Data.Coins.Value
            local coins = players.LocalPlayer.PlayerGui.Data.Coins.Value
            return coins
        end
    end)
    
    if success and result then
        return result
    else
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏î‡πâ: " .. tostring(result))
        return nil
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á request ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ß‡πá‡∏ö API
local function getTradeCommand()
    local success, result = pcall(function()
        local response = requestFunction({
            Url = WEB_API_URL,
            Method = 'GET',
            Headers = {
                ['User-Agent'] = 'Roblox-Trade-Control-Script/1.0',
                ['Accept'] = 'application/json',
            },
        })
        
        if response and response.StatusCode == 200 then
            local data = HttpService:JSONDecode(response.Body)
            printToConsole("üì° Response ‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡πá‡∏ö: " .. tostring(response.Body))
            return data.command
        else
            error('HTTP request failed or status not 200')
        end
    end)
    
    if success then
        return result
    else
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏î‡πâ: " .. tostring(result))
        return 0 -- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ß‡πá‡∏ö
local function sendStatus(status, message)
    local success, result = pcall(function()
        local data = {
            status = status,
            message = message,
            timestamp = os.time(),
            place_id = getCurrentPlaceId(),
            coins = getCurrentCoins()
        }
        
        local json_data = HttpService:JSONEncode(data)
        local response = requestFunction({
            Url = WEB_API_URL .. "/status",
            Method = 'POST',
            Headers = {
                ['User-Agent'] = 'Roblox-Trade-Control-Script/1.0',
                ['Content-Type'] = 'application/json',
                ['Accept'] = 'application/json',
            },
            Body = json_data
        })
        
        if not response or response.StatusCode ~= 200 then
            error('Failed to send status')
        end
    end)
    
    if not success then
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏î‡πâ: " .. tostring(result))
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö join place
local function joinPlace(placeId, reason)
    local success, result = pcall(function()
        printToConsole("üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á join place ID: " .. placeId .. " (" .. reason .. ")")
        local TeleportService = game:GetService("TeleportService")
        TeleportService:Teleport(placeId)
        printToConsole("‚úÖ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£ join place ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
    end)
    if not success then
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ join place ‡πÑ‡∏î‡πâ: " .. tostring(result))
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö place 14119723130)
local function warpToPosition()
    local success, result = pcall(function()
        local player = game.Players.LocalPlayer
        local character = player.Character
        if character then
            printToConsole("üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î...")
            character:PivotTo(CFrame.new(Vector3.new(-2132.24, 490.66, 1106.83)))
            printToConsole("‚úÖ ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (-2132.24, 490.66, 1106.83)")
        else
            printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö Character ‡∏Ç‡∏≠‡∏á LocalPlayer")
        end
    end)
    if not success then
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÑ‡∏î‡πâ: " .. tostring(result))
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏±‡∏ô Trade Start Script
local function runTradeStartScript()
    local success, result = pcall(function()
        printToConsole("üìú ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ô Trade Start Script...")
        loadstring(game:HttpGet(TRADE_START_LOADSTRING))()
        printToConsole("‚úÖ ‡∏£‡∏±‡∏ô Trade Start Script ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
    end)
    if not success then
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ô Trade Start Script ‡πÑ‡∏î‡πâ: " .. tostring(result))
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏±‡∏ô Trade Stop Script
local function runTradeStopScript()
    local success, result = pcall(function()
        printToConsole("üìú ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ô Trade Stop Script...")
        loadstring(game:HttpGet(TRADE_STOP_LOADSTRING))()
        printToConsole("‚úÖ ‡∏£‡∏±‡∏ô Trade Stop Script ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
    end)
    if not success then
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ô Trade Stop Script ‡πÑ‡∏î‡πâ: " .. tostring(result))
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î‡πÄ‡∏Å‡∏°
local function shutdownGame()
    local success, result = pcall(function()
        printToConsole("üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î‡πÄ‡∏Å‡∏°...")
        game:Shutdown()
    end)
    if not success then
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏¥‡∏î‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ: " .. tostring(result))
    end
end

-- ‡∏ô‡∏≤‡∏¢ A: ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô script (1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
local function personA_scriptRunner()
    printToConsole("üë®‚Äçüíº ‡∏ô‡∏≤‡∏¢ A: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡∏£‡∏±‡∏ô script)")
    
    while is_running do
        local success, error_msg = pcall(function()
            local command = getTradeCommand()
            local current_place_id = getCurrentPlaceId()
            
            if command == 2 then -- Start Trade
                if current_place_id == TRADE_START_PLACE_ID and not script_run_flags.start_trade_ran then
                    printToConsole("üë®‚Äçüíº ‡∏ô‡∏≤‡∏¢ A: ‡∏£‡∏±‡∏ô Start Trade Script (‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å)")
                    runTradeStartScript()
                    script_run_flags.start_trade_ran = true
                    sendStatus("success", "Start Trade Script ‡∏£‡∏±‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
                elseif current_place_id ~= TRADE_START_PLACE_ID then
                    local coins = getCurrentCoins()
                    if not coins or coins < MIN_COINS_THRESHOLD then
                        printToConsole("üë®‚Äçüíº ‡∏ô‡∏≤‡∏¢ A: ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏°‡πà‡∏û‡∏≠ ‡∏£‡∏±‡∏ô Stop Trade Script")
                        runTradeStopScript()
                        sendStatus("error", "‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ ‡∏£‡∏±‡∏ô Stop Trade Script")
                    end
                end
            elseif command == 1 then -- Stop Trade
                if current_place_id == TRADE_STOP_PLACE_ID and not script_run_flags.stop_trade_ran then
                    printToConsole("üë®‚Äçüíº ‡∏ô‡∏≤‡∏¢ A: ‡∏£‡∏±‡∏ô Stop Trade Script (‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å)")
                    runTradeStopScript()
                    script_run_flags.stop_trade_ran = true
                    sendStatus("success", "Stop Trade Script ‡∏£‡∏±‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
                end
            elseif command == 3 then -- Shutdown
                printToConsole("üë®‚Äçüíº ‡∏ô‡∏≤‡∏¢ A: ‡∏õ‡∏¥‡∏î‡πÄ‡∏Å‡∏°")
                shutdownGame()
                is_running = false -- ‡πÉ‡∏ä‡πâ flag ‡πÅ‡∏ó‡∏ô break
            end
        end)
        
        if not success then
            printToConsole("‚ùå [ERROR] ‡∏ô‡∏≤‡∏¢ A Error: " .. tostring(error_msg))
        end
        
        if not is_running then
            break -- ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å loop ‡πÄ‡∏°‡∏∑‡πà‡∏≠ shutdown
        end
        
        wait(CHECK_INTERVAL)
    end
end

-- ‡∏ô‡∏≤‡∏¢ B: ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏¢‡πâ‡∏≤‡∏¢ place
local function personB_placeController()
    printToConsole("üë®‚Äçüíº ‡∏ô‡∏≤‡∏¢ B: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏¢‡πâ‡∏≤‡∏¢ place)")
    
    while is_running do
        local success, error_msg = pcall(function()
            local command = getTradeCommand()
            local current_place_id = getCurrentPlaceId()
            
            if command == 2 then -- Start Trade
                if current_place_id == TRADE_START_PLACE_ID then
                    -- ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà Start Place ‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£ (‡πÄ‡∏ô‡πâ‡∏ô ‡πÑ‡∏°‡πà‡∏á‡∏±‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ß‡∏≤‡∏£‡πå‡∏õ‡∏°‡∏±‡πà‡∏ß)
                    printToConsole("üë®‚Äçüíº ‡∏ô‡∏≤‡∏¢ B: ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà Start Place ‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£")
                else
                    -- ‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà Start Place ‡πÉ‡∏´‡πâ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÑ‡∏õ
                    local coins = getCurrentCoins()
                    if coins and coins >= MIN_COINS_THRESHOLD then
                        printToConsole("üë®‚Äçüíº ‡∏ô‡∏≤‡∏¢ B: ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÑ‡∏õ Start Trade Place")
                        joinPlace(TRADE_START_PLACE_ID, "Start Trade - ‡∏ô‡∏≤‡∏¢ B")
                        -- ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï flag ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≤‡∏¢ place
                        script_run_flags.start_trade_ran = false
                    end
                end
            elseif command == 1 then -- Stop Trade
                if current_place_id == TRADE_STOP_PLACE_ID then
                    -- ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà Stop Place ‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£ (‡πÄ‡∏ô‡πâ‡∏ô ‡πÑ‡∏°‡πà‡∏á‡∏±‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ß‡∏≤‡∏£‡πå‡∏õ‡∏°‡∏±‡πà‡∏ß)
                    printToConsole("üë®‚Äçüíº ‡∏ô‡∏≤‡∏¢ B: ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà Stop Place ‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£")
                else
                    -- ‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà Stop Place ‡πÉ‡∏´‡πâ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡∏Å‡∏•‡∏±‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÑ‡∏°‡πà‡∏™‡∏ô coin)
                    printToConsole("üë®‚Äçüíº ‡∏ô‡∏≤‡∏¢ B: ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡∏Å‡∏•‡∏±‡∏ö Stop Trade Place ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ")
                    joinPlace(TRADE_STOP_PLACE_ID, "Stop Trade - ‡∏ô‡∏≤‡∏¢ B")
                    -- ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï flag ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≤‡∏¢ place
                    script_run_flags.stop_trade_ran = false
                end
            elseif command == 3 then -- Shutdown
                printToConsole("üë®‚Äçüíº ‡∏ô‡∏≤‡∏¢ B: ‡∏õ‡∏¥‡∏î‡πÄ‡∏Å‡∏°")
                shutdownGame()
                is_running = false -- ‡πÉ‡∏ä‡πâ flag ‡πÅ‡∏ó‡∏ô break
            end
        end)
        
        if not success then
            printToConsole("‚ùå [ERROR] ‡∏ô‡∏≤‡∏¢ B Error: " .. tostring(error_msg))
        end
        
        if not is_running then
            break -- ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å loop ‡πÄ‡∏°‡∏∑‡πà‡∏≠ shutdown
        end
        
        wait(CHECK_INTERVAL)
    end
end

-- Main Loop
local function mainLoop()
    local success, error_msg = pcall(function()
        printToConsole("üöÄ Roblox Web-Based Trade Script Started! (Coroutines)")
        printToConsole("üåê Web API URL: " .. WEB_API_URL)
        printToConsole("‚è±Ô∏è  Check interval: " .. CHECK_INTERVAL .. " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
        printToConsole("üïê Action Cooldown: " .. ACTION_COOLDOWN .. " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
        printToConsole("")
        printToConsole("üéØ ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö:")
        printToConsole("   1: Stop Trade ‚Üí Place ID: " .. TRADE_STOP_PLACE_ID)
        printToConsole("   2: Start Trade ‚Üí Place ID: " .. TRADE_START_PLACE_ID .. " (‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç > " .. MIN_COINS_THRESHOLD .. ")")
        printToConsole("   3: Shutdown Game")
        printToConsole("")
        printToConsole("üë• ‡∏£‡∏∞‡∏ö‡∏ö Coroutines:")
        printToConsole("   üë®‚Äçüíº ‡∏ô‡∏≤‡∏¢ A: ‡∏£‡∏±‡∏ô script (1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)")
        printToConsole("   üë®‚Äçüíº ‡∏ô‡∏≤‡∏¢ B: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏¢‡πâ‡∏≤‡∏¢ place (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á)")
        printToConsole("   - ‡πÅ‡∏¢‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÜ")
        printToConsole("   - ‡∏ô‡∏≤‡∏¢ A ‡∏£‡∏±‡∏ô script ‡πÅ‡∏•‡πâ‡∏ß ‡∏ô‡∏≤‡∏¢ B ‡∏¢‡∏±‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ")
        printToConsole("   - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏£‡πå‡∏õ‡∏°‡∏±‡πà‡∏ß")
        printToConsole("")
        printToConsole("üõ°Ô∏è  ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô:")
        printToConsole("   - ‡πÉ‡∏ä‡πâ pcall ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô")
        printToConsole("   - ‡∏£‡∏±‡∏ô script 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≠‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á")
        printToConsole("   - ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï flag ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≤‡∏¢ place")
        printToConsole("   - ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô console ‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô")
        printToConsole("   - ‡∏™‡πà‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ß‡πá‡∏ö")
        printToConsole("----------------------------------------")
        
        -- ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        local current_place_id = getCurrentPlaceId()
        local coins = getCurrentCoins()
        printToConsole("üìç Place ID ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: " .. tostring(current_place_id))
        if coins then
            printToConsole("üí∞ ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: " .. tostring(coins))
        end
        printToConsole("üü¢ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡πá‡∏ö...")
        printToConsole("----------------------------------------")
        
        -- ‡∏™‡πà‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ß‡πá‡∏ö
        sendStatus("ready", "‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á (Coroutines)")
        
        -- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô coroutines
        local personA_thread = coroutine.create(personA_scriptRunner)
        local personB_thread = coroutine.create(personB_placeController)
        
        -- ‡∏£‡∏±‡∏ô coroutines
        coroutine.resume(personA_thread)
        coroutine.resume(personB_thread)
        
        -- Main loop ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö coroutines
        while is_running do
            local loop_success, loop_error = pcall(function()
                -- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ coroutines
                if coroutine.status(personA_thread) == "dead" then
                    printToConsole("‚ùå ‡∏ô‡∏≤‡∏¢ A coroutine ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô")
                    is_running = false
                end
                
                if coroutine.status(personB_thread) == "dead" then
                    printToConsole("‚ùå ‡∏ô‡∏≤‡∏¢ B coroutine ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô")
                    is_running = false
                end
            end)
            
            if not loop_success then
                printToConsole("‚ùå [ERROR] Error in main loop: " .. tostring(loop_error))
                sendStatus("error", "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô main loop: " .. tostring(loop_error))
                printToConsole("üîÑ Restarting loop in 5 seconds...")
                wait(5)
            end
            
            if not is_running then
                break -- ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å loop ‡πÄ‡∏°‡∏∑‡πà‡∏≠ coroutine ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
            end
            
            wait(CHECK_INTERVAL)
        end
    end)
    
    if not success then
        printToConsole("‚ùå [CRITICAL ERROR] Script failed to start: " .. tostring(error_msg))
        sendStatus("error", "‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÑ‡∏î‡πâ: " .. tostring(error_msg))
    end
end

-- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå
mainLoop() 
