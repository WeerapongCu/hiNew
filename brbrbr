-- ตัวแปรสำหรับรายชื่อผู้เล่น
local SENDER_LIST = {'vidnspdj2625', 'gpfjjocn7547', 'edmqllqp5909', 'AVlsiITZ7635', 'AyVeLmnC8345', 'glnjwDAL7473',
                     'jfypsgdg8829', 'fLTyGFJp3346', 'cqzeyyrh8852', 'kjjlpjfv1417', 'nhkqxkjn3330', 'bnbppfhc1523',
                     'ztmimgbi5310', 'cnfityfj3426', 'cbqzmlvj9726', 'zzfkknbp3953', 'zQvuQXQG7319', 'gvncfuxa2404',
                     'xjquaust1903', 'fqisovqh2859', 'qsdxlyow4823', 'zlgfcgwi9582', 'wbluoyjn1623', 'bufxkafo1410',
                     'azpnbsdu6972', 'jnlgqjuk1270', 'mwlbacyl2581', 'kbclrfwa2288', 'DXFjTJOM0020', 'qvjeence2196',
                     'QRMLPwVW2820', 'acnagyfx6287', 'bcnvtmrg8544', 'yhcpnfox5350', 'wvmmshba2031', 'ptaurspr7208',
                     'dmcpnpel4815', 'vkqhdewa7716', 'uhzpkksf1507', 'apigmuzn4732', 'cfsciazf5622', 'iennjqud9362',
                     'vwyccjlm3044', 'iuraqlbk3775', 'jwgkxgiu0479', 'clrxdaqi2430', 'ralzgzgx2105', 'BKHkieNC2105',
                     'mnlbvjnq9910', 'mhhjvfdl0172', 'vyytbkna8326', 'vlbvmcxo2882', 'plbkxcbh6722', 'vuDpTCJc5880',
                     'llhagqfr6666', 'vydlzwje5416', 'yteefpyh7850', 'pwvzheti0487', 'xrggrlcp5567', 'vweixqwo7996',
                     'tlGDfjFo1866', 'HHPGWcKr6475', 'juoahfse9943', 'umfxgbzg4018', 'ctlfegrk3894', 'camsikkv5588',
                     'leaysiig4692', 'dldbqnrx0289', 'cigovfti0202', 'ijmjztfk6672', 'gflauhwb5867', 'tqwmuibb5520',
                     'ydlkveqa5334', 'oxpifrlp8708', 'rhsoarkz8862', 'aFwKlygb5447', 'KlxAnkPh5089', 'wzjnwmsi5977',
                     'hfosiglp0031', 'abiwfuia1732', 'wnctmdbv5130', 'uxxhxkzy1575', 'vznybkqk3132', 'yutwtpyn5403',
                     'phpnfdwh0029', 'jybhddwd6558', 'lvsaryyg1952', 'ozcfehvm4132', 'CSRGsjgQ8606', 'xeoAvXNc5941',
                     'onxwugdv7083', 'giawmwja3378', 'vadylesk5737', 'nlzicjhp6286', 'igqasjqf1607', 'mwqvjyyq1662',
                     'efhpxzfe3581', 'gzbofvya3660', 'aymyffig1792', 'hqnmuatb5503', 'zaamlvil9575', 'mbboihmi0408',
                     'eovqfnrc9786', 'jjxjhfau7114', 'oqaozrzp0589', 'sddbxcln2723', 'nfykhalv4983', 'ryfupqqc2547',
                     'xeujopoi3018', 'vduykzky3314', 'ybmjyocx0236', 'uboksfwf0373', 'WgLIDyMO3140', 'ezdmerca5739',
                     'IWKnSMHE9714', 'xilcxnth4234', 'WHnFOCiR5526', 'uyamuafz3016', 'fdzpiouc4344', 'QxXxpRBw1472',
                     'tqabtexl2761', 'cmzjfptq4929', 'edxdbuqu1187', 'efkzzrtf0271', 'sqhmopmh4140', 'gfhzrzqm9251',
                     'fcnzevqa9813', 'uuqmapii3776', 'hmdfyrbb5207', 'ygzqgacp6175', 'ptleevxe0000', 'etqtpbel0909',
                     'cshnlnae3798', 'jfveuwbv1951', 'RaEnopRH9839', 'ydxmmhis0692', 'VwJjIxiB3912', 'tggmgocg4578',
                     'djjsmuxv0655', 'yproyefo0040', 'RHxKhydQ5630', 'rxrqqrhl5299', 'eKIYIIjf5024', 'pshdbbwv2870',
                     'epdswlhr2736', 'raoeiepq9504', 'urevtici5393', 'vvdwqmnn2512', 'mliuqjvf6806', 'urjwfooe2279',
                     'axpLOZVs9219', 'iurfxcud0691', 'htlwohgu0706', 'tzwcgsnw2818', 'jllqcefe3605', 'byxjaokp0438',
                     'jxHRfPBM6648', 'pafyqjau2086', 'echvonws7031', 'sswstqtv3966', 'lwsymaos9457', 'bqovgrpr7470',
                     'kiokxvoe0478', 'VGSycZup8801', 'fewfufui3470', 'znbqdnyj7316', 'lowzlltd7131', 'vajpceri1923',
                     'cCZHKQlg1036', 'zxgkmpey9272', 'XjzfCMqa7624', 'pzxmouma7940', 'dqonvhsl0017', 'clbqvtkl5945',
                     'yddfqazn9691', 'bxanvuqn4813', 'xjyrsmbj8403', 'rtadjynm8236', 'acbvqxtp5563', 'itofpfwb0086',
                     'achchbmr9380', 'yoaeljos5994', 'zecurwsx6819', 'rbscteqj0364', 'nisdtffh3867', 'sjfjehsa0674',
                     'qdnstlxd9173', 'pnvqeveg6054', 'nzjqsvli6821', 'lfdkudvt2093', 'xinoOPDx8684', 'aumhublt8135',
                     'qdprgpib2081', 'ujfxrzcu0262', 'ubozvzwu9926', 'oamwmttm0927', 'mpduzbpk5190', 'xwzgwjxl2791',
                     'qngmesyh8984', 'mqmmdqpd4474', 'YPZMoKmg9314', 'xbADvRSg1127', 'pIMtrUQh1096', 'goxhabae2212',
                     'tdsfebdk3659', 'maxzssme0144', 'wxktllet7821', 'wonuttlp9435', 'oqsycvny6169', 'VfZPIGyi8938',
                     'bvdgrora7959', 'zxzRYcjI3780', 'adjzFCdb7684', 'hyeReOrs1903', 'nbpiudfz9723', 'bgybtivy8127',
                     'vaaazxle7690', 'fusijryf7725', 'uyfdjlmg0823', 'yjjfshob9439', 'pffkgjhs5637', 'rmamnvqe8240',
                     'yvlmrepi5390', 'vuedbzfx6993', 'mKVlRfla5914', 'kphoadqj5380', 'VWRfJXRA8230', 'qoqpupxt9283',
                     'mkydumyq3249', 'bzbxqyjd7960', 'amandhtk5338', 'aCeqWdRa6949', 'jizbofdr7565', 'tqkxmies7067',
                     'skvfejif5208', 'kmlvktha6606', 'jswebqci8763', 'RugQuQnV4713', 'bgwjissl1752', 'MkWKEfWW0905',
                     'avwhmdmi0427', 'czgqrlpf8603', 'tjwhqkyf3765', 'kaltpgmn0362', 'lzypfviw7083', 'LAkKJPDE1872',
                     'eQiUBvmm6223', 'utuchgln6872', 'zndngjsd1926', 'pwripffz8754', 'rcqocuxd1037', 'wgofwgme0536',
                     'qnsnezbh0208', 'qwpdsiuh5582', 'dbghwlqj8238', 'aqnfnwlb2963', 'vgklkcvm4737', 'SnTalNdf6924',
                     'DpAZyuwi2208', 'dayvqbrk3331', 'jzlvekxt0157', 'bexyjtoz0911', 'koeprnff3427', 'eqxafaGD5582',
                     'tfcimeck8590', 'xwypznwq7437', 'ckoejqcp1773', 'zrdeysye5958', 'VRQqnjzM0366', 'kMzFqLog7567',
                     'beaikius4131', 'peydcczl4437', 'zvoforlm1521', 'yjejxsym6602', 'xpnlpbmx5822', 'fctuxoye8590',
                     'wkwefxcy4377', 'mucwkdlk3357', 'vjzjrwku8853', 'nukuiabs8340', 'apfygwoq3962', 'mvhojcdj9563',
                     'ehcwwfiw2184', 'ARxUXaPR9067', 'heyycles0892', 'yPSgfEMb8119', 'vmscmkra2048', 'cfbtlLyx8016',
                     'xoetwkpb3154', 'mfobzszh8438', 'wvuaiema7133', 'MIVcDQTt3034', 'hkctwjwj9295', 'vydwfglb0873',
                     'muizeigb0683', 'tsqdzovx8485', 'tMelqFhE3547', 'dytyrgns2080', 'pkqeyxde2199', 'izwkakaq4036',
                     'fwygxyfe5367', 'pSamLlXB9363', 'ycvsaiob9339', 'itgckboe5475', 'toztjkhn2980', 'gbmjefkr8138',
                     'hsijmpxz7412', 'pbzgobun4078', 'yrsssprh4602', 'EsMXrwYB4906', 'vcbzjtph9373', 'cvzwbhnm6734',
                     'jsmhmndp3581', 'pmalztec5284', 'yYxjdbnK8088', 'cxzgwidw0439', 'vkctrvew4914', 'rjikbinh6137',
                     'uaDVIfDp1260', 'QCzPPpKF1287', 'ojidsflh5864', 'galugald7706', 'txcraarx8049', 'AlOGraod2123',
                     'dvmhakaq3847', 'btseejor3623', 'hzbklfiv7598', 'wtlsqnvf4398', 'fdwnszjk8401', 'akUtggSp5802',
                     'hlcodzrp7725', 'hgkxowyw4494', 'acgmsvny2267', 'zvjegmsm1750', 'yjwhehsw1309', 'nmgcpszj3240',
                     'cdmyzszf1569', 'kbhzpour6602', 'everdxjl3755', 'HpjeHyPq7017', 'qcxjxctr9918', 'jwqlneld2758',
                     'vqqbqrud2135', 'tPhDCmeP8718', 'kQSCCVaR5635', 'vhwasgii5101', 'raxaxkqj6828', 'ewjmnlgy9090',
                     'ywwktqbq3186', 'siplcnof6091', 'lfmqamzc7466', 'dsiinagd4872', 'bzibqnrl4263', 'xsnvyusu7355',
                     'ijshjjsf2751', 'ahhqkgwa2068', 'dudffjfb7611', 'nacydrgo5100', 'dhelxxdr1739', 'bebaaofh6297',
                     'fccwgeoy7475', 'mhzugjxa0784', 'frdlomnc3810', 'yiwdsglt6299', 'wuyvfivy8118', 'tddlchpb8440',
                     'cvfnjlmk5595', 'JifrkrcA3433', 'vzkrsuzr2007', 'hkQUKRnm1350', 'yhkmgqxk6763', 'xotnxnza4247',
                     'rvlesqoi7280', 'wpxbgvez2678', 'rgpplvyf7122', 'zpuygxmh2349', 'aqkcgfuq2132', 'hhornwhy1142',
                     'oqltquos0217', 'nlafcwgd4180', 'tjfycdee4717', 'ifpptynv2855', 'rudlnbgi7174', 'LKwcnttD4188',
                     'oknmajlq3163', 'eoaxhzbu8607', 'mpzmlvcu4832', 'apclkmpi0062', 'SxqlntBu4012', 'xtpywspo2725',
                     'qrznpilj0514', 'gjdkoacn9326', 'MFPIpfRm5955', 'xpdfzwys2766', 'uceridxc1333', 'jmoysezc2593',
                     'rzjatcdl3670', 'lrdywroe5475', 'ghamuwxg4429', 'rjxnwjas5911', 'dwibqtbz1387', 'gfnnrkvz1304',
                     'bnudqqcr0465', 'lOxsLotD0696', 'wsgeljsy5865', 'bpkmnyyn5980', 'rkdhikpk4029', 'earzdrue3334',
                     'qtlgpckk9801', 'fxnbqrui9715', 'qbdagwwv2472', 'pwdtvpcl0433', 'fkbikant5841', 'gbhDtIVH7836',
                     'ttapwgkj1159', 'toamivxr1144', 'mtrgfnwa2225', 'skyzadmq0896', 'qzsydchr8412', 'cctrxtrd3570',
                     'qymyxrif6798', 'qjbiocxv0300', 'wnwwbuxa0482', 'chsvqujq3008', 'nwdbtlsa0639', 'wlxcipib9908',
                     'crzyeidc5175', 'ubxdtiry0004', 'ejlyhvfb5358', 'gckdmnmw5062', 'mcpejwoe9354', 'hptavbvz1914',
                     'fsrlahbh1199', 'wxopbyil3191', 'rlyyhhtj0459', 'dxgtvgqy3297', 'fjXiBQyE2690', 'xubzlsax2305',
                     'xHUWwhEz8013', 'zlygxvlj1979', 'qmeyszyp8462', 'ccmwlmdk5669', 'DRHTABGe8619', 'ybqvodtu5940',
                     'yvsksodu5590', 'begkikcp5279', 'azzkkhmf4480', 'jWFptvyq8843', 'plczqdik1459', 'WVQNjfra9837',
                     'hpclgaij3198', 'lvxqxzrt6055', 'zhqkosee3616', 'joyyyxze4929', 'bvspbeva1330', 'zbjrkvzg8505',
                     'zTUZSljJ9605', 'enasdqkz3135', 'ZULhXTJM1668', 'cdsemwyx1984', 'scjhyqbn8583', 'gzrnatqh7064',
                     'nsykqpzv5237', 'oxnrlets3987', 'hnpvhmbm0695', 'yiltshzt6718', 'jonjppxh6949', 'mZAabSBt4370',
                     'bfupqbxr2473', 'ayritish6988', 'JqaFvIpa7147', 'dvkdemmc6420', 'tljbeaqt4297', 'ZuGTQIOJ1614',
                     'mkvEiegK4602', 'nwlirgyv5404', 'VWJNzLct7624', 'grxhfkjc6275', 'mwvzngir7931', 'gsrwpqmd6854',
                     'WoxEbDwJ0198', 'rnagavhr9184', 'ycfkgbub9785', 'akvtzbmv0338', 'worlxIZH8620', 'lfkfhcjc4563',
                     'eyfjnlca9282', 'joanflaa2106', 'rkthezgz1749', 'kmlgcfhd6495', 'euhkmdgi3725', 'xurlwomh1894',
                     'DXOGDsZU6887', 'kzuggsuk8846', 'pnrzmghw1804', 'tvgobwcj9781', 'tlugkobi1383', 'efyramhg0836',
                     'xljdylaz9719', 'SkFzRYIi9944', 'tkhzqszi7806', 'xYLTvCCP2480', 'dzplnlzh5014', 'bxgtspew4717',
                     'cGHEujwg8246', 'zmaeqsij2620', 'tprvtrck0203', 'ipbhaiok5534', 'xqsspjku8364', 'qdihfncy8202',
                     'hfmwcccs9056', 'vxhmkyka1184', 'kwfpecsg4771', 'jcdvnpth0418', 'zyxfshty6285', 'fanzlbyy7305',
                     'mqqEOBIY0427', 'ijeybcyb0159', 'vmckfalw8414', 'hpmMYKUc3408', 'smxtdxiy9481', 'akgOIkWh2327',
                     'ythjfglk9674', 'xyvibdwt8421', 'uytxidyl6359', 'emgpbiow3082', 'IVGikKvf0302', 'uhoppzfv7656',
                     'txhgrxna1819', 'ixanchyy7872', 'dufnlchz7156', 'ayeurjku9138', 'tdwxnxdf0663', 'ftBVCeGb2488',
                     'dJMmXtXQ8260', 'vdlkevzo0404', 'xzdllupg9441', 'efdgmgqi4544', 'oetppjmk9501', 'qmfoyzlx1207',
                     'axupnjso4635', 'jlpjyenx6150', 'PTtpWRjZ2667', 'acghyywu2593', 'nulonnab1195', 'UYGjetNr4149',
                     'aegbccks6633', 'hkdzdvyi7539', 'phocdtca7472', 'dvrlflca6767', 'zopfzqpx5889', 'nvlbdsop5729',
                     'BqBfkTiW7260', 'mmjuqbxq1346', 'LqxFueTZ0392', 'KhNdHiOo4466', 'xidovpkh0699', 'bfrztwkj0415',
                     'dZlGxzgt5080', 'otrdxuug4291', 'htklrmtt5663', 'bwsvwijs9107', 'ceezhbom0834', 'qirgigcf7955',
                     'taovNpMM1420', 'evcugeml8700', 'wvwdxrda0677', 'hZfKgrtk0600', 'IwoqkTbZ8631', 'USlCKqUN2956',
                     'bmeoehnw0604', 'nmeoplbm2120', 'wlSDMIkz6474', 'dcbgctdr0024', 'zfgxkdky9471', 'vwvfgwlr6067',
                     'aVzuzawO9475', 'qtnytuka8948', 'hddvqhel0769', 'crypfflk8416', 'leyvrfxb6683', 'qgvnezhg2087',
                     'etgqufsi0169', 'xygmojda5740', 'yftyvcmq8215', 'MoemVSKa4413', 'zuxkiapm9648', 'zcirslnh7774',
                     'gazmhcin2101', 'jkvjypif9447', 'tmleusls4330', 'epzaqkly2801', 'eqdmgbsw8509', 'xefekqrw3613',
                     'dwhcgrvr0827', 'ernhbuto4694', 'mayqkmwe9110', 'uskignhu4257', 'ykmqdpyx3242', 'drlqzegy0024',
                     'MuFeVoUh2873', 'btwcliue6117', 'ioyzozae5265', 'xVLTPFUS7119', 'igjdmqtq4404', 'jjkialrp9336',
                     'lizrgjxh4187', 'cqobtttc9907', 'cbilDHko4689', 'pniqiiru6457', 'dgztajcf4696', 'zmkiaasp7110',
                     'sslecgnc1242', 'tgbrrtfk9873', 'vfdxzcrx7843', 'HeXrotqw8810', 'vvnnrtmq0777', 'lbbxfurl2630',
                     'nyjwqjxx8697', 'optnpsgq5111', 'razfxjjd1718', 'dttytadm3220', 'iemfolcl0329', 'faatzixo8638',
                     'cqddpkqh5358', 'ikjjoumg8146', 'DMGKMvAp6436', 'fHDQLRzp9929', 'UHFCsAhg6144', 'efjxfhcy0460',
                     'wuitavjq2693', 'uYmZEeiG7797', 'ikkhkpaq9523', 'ufuqrern2161', 'udnfcxiu6321', 'mzzjxosb5577',
                     'xfjnhatw9055', 'UPoepgWS4184', 'pmltjmar7434', 'qkmuucpy3679', 'yWkNPrTT7088', 'cknarvyj4278',
                     'agiiigku4016', 'wnufwzaq3174', 'mjyfycmj1945', 'sbifgdjg4854', 'gqyahjoy5091', 'eullkgzi3645',
                     'czrglhhb5498', 'vcaxhaud5810', 'ealbvctf9697', 'aprxvhfh9004', 'tiqyqbym7625', 'rmumirng2980',
                     'EaGsnGFv0695', 'eedwqcbt5112', 'GzxORsuD8744', 'ixwunypm3373', 'wmfhxoot3829', 'Ffzfktvw4246',
                     'cuydurdm2971', 'hlcwmyfn2171', 'lUxkQUHq2274', 'nsvkgwce7758', 'jyjogfyd1441', 'zfmdgjnc8272',
                     'butrobuj3209', 'xAKGTqla0006', 'mbwguoeq7394', 'mkjrwwnr1716', 'uojpqdnn8861', 'ayrefono3037',
                     'jqktrupt0004', 'wwvviojg6499', 'jzeoxwpj4861', 'pohxudhq4051', 'ymanhbfr8798', 'nuANwtKD5745',
                     'imkatrqy0144', 'bswjbixo4740', 'vsvyzuTe1431', 'stharpeu8784', 'doomnzwd0946', 'jkxqocoj9660',
                     'BHNJfRkn4490', 'qqbaqazf2663', 'ttnghjob5825', 'msdgvmoq0136', 'gmjidubo8038', 'whcqpnvg9890',
                     'qvibggjl8569', 'kmcbjecq9240', 'AHXJNJSB8360', 'ewirfbec4024', 'aWhpjSYl1057', 'jgitenpv6339',
                     'wfdetrze3982', 'vmraexyk3605', 'iLpJbxrY0332', 'rnmooqtk2268', 'qocfxtrt3950', 'tqenpcwh2478',
                     'zrzvjorc4576', 'naiuBTeV6697', 'srugocfl5265', 'eziemmap9819', 'djkwtdgh5856', 'wldhrkka3482',
                     'DGEujNCa8456', 'bbytvkjm2870', 'UDtlErhj2771', 'gftsvmuc8461', 'lxjopclp9253', 'SylyhonD3131',
                     'ahfnywnd8599', 'mzsplaxr7039', 'biuuljmt7567', 'wvuejcxk7228', 'cFPwLOjt3634', 'xwzergdt9708',
                     'wvbljvcz4483', 'dypplxbz2616', 'zwexxpxv7049', 'eqsthujc8163', 'jozctqps7503', 'pwoxaxdi2491',
                     'edwrmwur5436', 'zundfhbf9683', 'xafmjfyz0634', 'mtptwjor1876', 'wDpwcpLw0340', 'puuzsbcd8340',
                     'qqbonmbt0818', 'JuGYBNKt6216', 'cxvnvcqh9450', 'kzomtoki1236', 'umbzdnrh8513', 'lmfqekoo3081',
                     'ryiycwca6656', 'ilsutikq4494', 'fhxqslzd0986', 'mrfwvfhk9626', 'ojjpmkhu1155', 'etehypnw0399',
                     'ukdfyjon9393', 'zifyqNwD2563', 'ebchwcnb6605', 'maanwjfy8103', 'PKgGoYWu4762', 'vdwtasrl0486',
                     'lUwWndfG6724', 'vcwneciv6263', 'howomdww6399', 'epbnvagd0054', 'rpewjwej1294', 'bgpetokk0172',
                     'zelewwyy6056', 'hctjPJDe2552', 'KsnBPXuY7475', 'hcoizjoo7013', 'PMfNJVOE4227', 'fllwzocq7392',
                     'fhgqdzzh1223', 'gakntmoh4228', 'rvlrnyth0440', 'zerpatbv8260', 'nqarkxgb7398', 'gFKaUuOf8038',
                     'qgajyycw4299', 'snyluiws6838', 'nHYcXWcf9820', 'azutattb6248', 'amimwygb6450', 'kldulamy1695',
                     'AdyRfXeM3077', 'vahylubw4587', 'znmsyqza2333', 'hZgEjSJt2729', 'tbqetxct9318', 'xpyupxaz0972',
                     'gwhpofrz4793', 'xphokpui9334', 'fdwmbkuy4847', 'mmlyryic8530', 'kntjejni5696', 'onlihoss5433',
                     'uZiBbuBe4947', 'foiaulcm3715', 'aztFmhxw3316', 'WZyZRZZW5467', 'pmjhluwd8942', 'uwufmcdi2460',
                     'igokjpib8807', 'kqdeposo7131', 'ftianszm4206', 'qQqzmmTE8247', 'pmhuprqg0945', 'MMKQITtl9343',
                     'mxsogecz1572', 'kjvfncbm9632', 'dttdvpth0284', 'GlPUNmqx6922', 'ruqfmszb6158', 'enmcgglh7210',
                     'sAxuYRCK8038', 'tgckvqxs2897', 'wtxhkubc5678', 'zpuleiho2658', 'jdbkhcoo7563', 'QgFaZpUA8736',
                     'vscevbal2496', 'qparpdrl4410', 'toaqcicm8938', 'flrijqkf5924', 'gXZyFHfs6548', 'tfkdeuww7576',
                     'uyuzxqcy8405', 'oqjngqci2129', 'bwwtrznk0313', 'cxawwevw6703', 'zeaozdes0755', 'yvfZrAYy3038',
                     'arbigpbw6021', 'ltbylflr5973', 'lcvhxoip9503', 'kxzwmyrd9059', 'mgnlsnlz3327', 'fslhcEUJ3288',
                     'zotfwsbp3387', 'tobewtin2856', 'gblpalim9867', 'AhgdRsZZ1695', 'hnsmnntq8669', 'lcaegzye1142',
                     'GTTXbYSk9333', 'vnluymyw5926', 'cgbmgeke9008', 'walolzws9047', 'dabtpdzz2213', 'gqbursxg8432',
                     'rbqxvrmv7047', 'uktmpceu2719', 'zFjlfkiQ9701', 'phnzdahz6127', 'sifpwjib9785', 'wykdxkbm9864',
                     'bmsogups8367', 'jlsddxij9090', 'aolSBlun7661', 'aeyoyrwy4374', 'isjadfqb1101', 'xdsjbjsq4422',
                     'stznjtkh0813', 'khkwadic2388', 'sxfddrtv7386', 'mavhpjho0633', 'wvgfjlai4483', 'qxipdxpc1766',
                     'rTImWQcc0486', 'mbjdznyb9796', 'fvqfxbmb0528', 'jshnpzdu9058', 'xxkGJeYk3729', 'bekhasaj8846',
                     'icgpiyyj6902', 'yzuyqehg8424', 'valrwdfs5639', 'dslcddiy7936', 'qyvpolcw4415', 'ewlkremk6163',
                     'kdhfahlc6604', 'qdiabhbu2712', 'IvJcjfNp4864', 'kQXWoFlF9036', 'CtwgxADz0056', 'onhsvxcm4971',
                     'SVkYClJf1460', 'oksaoqci9224', 'ixoavlpm5932', 'zebmwpuz9137', 'lbayzgiy0740', 'efgcsigt9246',
                     'knfgkxyd5237', 'rmWmOuJy2968', 'koZJpDRt6238', 'wuejagcb4854', 'efTFxRQn2292', 'ojbfnacq2547',
                     'vzqvrlpe9188', 'fixazpko6131', 'oukiecko5670', 'ZJKLJKLY0270', 'hoiudgkn1783', 'FvKwAmcn9603',
                     'aNEVEpgJ5495', 'ekafseum3882', 'zbEbRLOV2488', 'kswjnwwr9587', 'OhajTGVF2206', 'voxyeers6182',
                     'IfecNpkQ1091', 'cwHwSrvw5259', 'zqopdkgd4355', 'fooiagas1706', 'dndsajth0124', 'kckvxigh7451',
                     'mwpswtyx5144', 'rehjjlbt0380', 'ujbgguul4877', 'hrkvjsqy2222', 'yiclrvwq7067', 'rrqaahbt7254',
                     'wqivievp9362', 'iqymjcxj9106', 'diwisjxf7740', 'varaksel8027', 'lxtjmqbc3144', 'ipopubzz3285',
                     'knxqimao0768', 'kbtuMSZj6597', 'albcwknx5909', 'gqhpyipi1815', 'ogkmsvwv2096', 'tsnavqro3575',
                     'indjolfw0292', 'wofdwttu3988', 'ycjuqfug6180', 'rduujcfu0345', 'vmfhiwsm8989', 'vIxeEkrT7801',
                     'palirgtm2223', 'SsTtpcRO8766', 'wULBczay7951', 'chibkkjj0773', 'rfwmozin2187', 'rscASbZk6044',
                     'fqfdiaia1663', 'ygtnktyg9124', 'gjbuqobq0084', 'istjcgxw1924', 'dbshduvq3562', 'TaDXNNrh5747',
                     'uttdhcme1369', 'uqpwbxgu4393', 'vyogllix2155', 'zaunzvcs9648', 'wkulsosh4599', 'FScJjdgF6650',
                     'mNLrbHzt1811', 'xhxqypgk9305', 'yqkybabi4149', 'bmkolopp9847', 'tgqjryup9553', 'kjhuvman8738',
                     'pwjsmdob7289', 'osqwqzth0308', 'qzscikya7580', 'HEEMFEqn0753', 'ntnrxydy6889', 'yPaiGgLe0015',
                     'aairdaER0269', 'qewmhite8306', 'senCDRIw2961', 'WuWBemzg0297', 'htbolkfu7456', 'vzwdetbu7510',
                     'oevylgxq2696', 'hXAfNEhW3702', 'XEWuWesC7961', 'iBoSzbDS1875', 'wjgrfyhu5799', 'jofngjws4595',
                     'gSAvqvoI5153', 'wgawocfx3541', 'bvmgeiuh8610', 'DUSmrKzC7920', 'FYoiAPhy4740', 'ngsqiyfr5856',
                     'eobjheid2490', 'dAqhuukC9627', 'mouiowof1265', 'mbfjstfy1882', 'elejezgl5997', 'myygcxoz6568',
                     'nkquimiv1400', 'pkgsatuj0678', 'uvigldus1529', 'ztcxriur5697', 'ytzdpfqm8779', 'lhdintzm2926',
                     'sgqlbdnv9581', 'kmYCbjIF5493', 'pygterke3503', 'qcozzdcc1760', 'fvnlkmxf4807', 'reijyfec8470',
                     'kWxtkVWn9388', 'gafkmjkf2662', 'luyalxed9195', 'zlziqycv2929', 'ifkyechc2695', 'xrtblfql1311',
                     'fznuumbi5257', 'ahcwpmyc8558', 'nlccekha7962', 'DCwWYvkw0964', 'mdniotff7842', 'rpxslowh1688',
                     'bnjdsfwl6468', 'cwgjnasj8371', 'jyibaczy8643', 'bmlsrsyw5152', 'ftkwymcv9045', 'eucsepmw2568',
                     'rpyzmlhi2095', 'aqTdVKDx5264', 'zoznnzjx7342', 'whAiSLgA6984', 'fbzuuefg6227', 'xqjkwdsv9492',
                     'dfispzif9117', 'quesjddt2618', 'vboeoklw0568', 'eevvsyiq9304', 'aumidkvj3389', 'tpakqrfx8213',
                     'akqrugij1084', 'kmttwlks1803', 'lefsjyxy6737', 'hsuvvqlb6413', 'xeoxuvqg0675', 'qdnqxudj2331',
                     'ozukiosp6219', 'TAIsMBsG1535', 'bsgfogje9354', 'yyldgcro2512', 'eflyvkkc3523', 'dweauxyc4688',
                     'ytsxmorf8652', 'hnntrtwj5214', 'gtfdxhyz6159', 'dmulqrzy4947', 'fgblrvdg2511', 'grwrehlz5202',
                     'skvvnysi8190', 'dqtsdoqz2436', 'bvkrckll2742', 'pkgbmlcv7986', 'rvysuhrb2115', 'xuoambkr0444',
                     'lpyizuqh3010', 'xfruenqw9046', 'hajghcky3960', 'tfmgqbmz2691', 'sghpncpt1036', 'wdajduif8425',
                     'goyhuixl3809', 'ipldtucu9454', 'ebjodrqw8395', 'ktxchhls7095', 'lcpbuuwg4433', 'ovakmjly1436',
                     'cyebhjzo0168', 'nohxsbbc4016', 'kgjuylkq5629', 'CohzdskA8546', 'dbkmymyj3772', 'isjapwwo3553',
                     'jtexixke5426', 'bhyvmsic6188', 'pnmopeyn8785', 'jorgzgrk4957', 'bstxhyzi9770', 'xxesalkl9201',
                     'amhgjmha1274', 'qfjejzln9648', 'ydpjnqcq0756', 'fzpusgdb1162', 'lttfanxc7847', 'nddpfsag2849',
                     'uxuiiadl9844', 'wvqoptzd5249', 'mniexega7454', 'yzxsnwdl2170', 'yshxyrjo5702', 'lskqcxdr1373',
                     'irqywmxc0177', 'btguazpk0193', 'rytxzgcd8411', 'oedyildl6836', 'fyxxzdvz6116', 'tevdqgtk9111',
                     'ymdrfrwm5941', 'ddiiaxre4029', 'yamgjtao7051', 'txesaspc8160', 'vosghvjv8543', 'oclpnlfx4122',
                     'sqjaxsub8222', 'lvsrkcco4744', 'wrzvwexz3173', 'vtvvbscr7697', 'oazsuwgm5549', 'kfcvxgst9701',
                     'ecfsswho8206', 'stnatejx2142', 'nytttgpt9829', 'qpnxnssz7505', 'wbirtnrg0302', 'igbqbkdx8305',
                     'kwkdvuuu0003', 'micywzxv6749', 'uvpbkebf3257', 'jvwollko0738', 'wywayhvj4129', 'mcqjaipa1099',
                     'jsbaakll0599', 'quhbdwkp4931', 'kgcxbwfv2374', 'lnubyuyw0413', 'gyanolec0682', 'hvohrafq6872',
                     'oztuqohk6788', 'cxuhvwqo3353', 'griuxehs1582', 'ksobenrx7163', 'xbbxnpjp8618', 'dxacflkn9478',
                     'dfvmrtqf5868', 'ommhbmrp6774', 'vhduklss7134', 'idauvduk9262', 'kuetjqyd2540', 'uendmter6602',
                     'pzeffeuk6242', 'tdmcihnr4562', 'nwaxzmxi1821', 'ueqewbkc3684', 'hfotmuum1156', 'ettzupkz7676',
                     'bjwxybnv3857', 'acnmnpxt3617', 'csjdrtvx0112', 'vihmqbbw8545', 'cupqlqkv9834', 'sdmtukgj3215',
                     'euriwiya4603', 'hbdxihff6347', 'qyfizwnq1317', 'qchpdmkb2185', 'crojqbym2481', 'tsalsptd7070',
                     'zhsuxdoi5168', 'shkwhgww1807', 'qpdoqyfn8446', 'qzsvgefd5400', 'cczamhmm5411', 'kumyhfvc8735',
                     'lubrvndv5900', 'elqpefcj6127', 'xspsmqzo2443', 'qdttdech9031', 'tpqjuiwb0414', 'xbamsvnf4286',
                     'lfrmqxxz8897', 'dmizfulj9423', 'ynhqrkaj1566', 'ulchoztc4107', 'liuselzw6133', 'brtvwyhh6016',
                     'imxbgqhw5478', 'sirizqsv6526', 'ibroohea7460', 'wpvisgwk6115', 'qznudzgn6566', 'wnvblgrv9187',
                     'mpflckzk0085', 'ogxawuhs4260', 'tgbrvnxd1965', 'sduvhhoc9805', 'uvdsgsew4834', 'mcpukrvu3113',
                     'jkqkxqba4594', 'vmnchpgw2683', 'cbrbtqzk6045'}
local RECEIVER_LIST = {'nyjnmvsz8702', 'kmivbqda5551', 'wxluypti5063', 'kqvkbbjx5843', 'tmpotdup9419', 'qwavnfuo2635',
                       'BbjXfLyx7579', 'DiTyEmtP7073', 'fiejifsb7963', 'vewqloye3249', 'daurchjl8227', 'xqsjmora2134',
                       'ssxnmhqk0478', 'ptsywxhv1744', 'aozfohwu5768', 'fffgrnwz7492', 'bltskfsj9303', 'exwoftdh7843',
                       'yxtdhnnd9468', 'lvktlwoz7534', 'vFxCoyzI4760', 'CTTwdUnw1216', 'kmeibzio7624', 'ogtojlup1297',
                       'xjsarbbk7779', 'gmdealfb9176', 'uLFjKcnX9655', 'lQpjDPPi1044', 'pcnpmiag9376', 'unallykg4152',
                       'sYVAUbem4193', 'auyhlfKj0293', 'mayikvbn5717', 'opzuxpio7280', 'nhhhxttg8140', 'unqzmfpg3237',
                       'xlvfscmz8846', 'lynpzlpr2040', 'ucqxijix5134', 'rrwnxgoa4148', 'EndJoOyW5770', 'lRdmRCVE0679',
                       'qbhfqqws1357', 'tinvijny7776', 'ytpzoxii3809', 'kkackzzs2467', 'iiewbewx8593', 'kfgavmct9229',
                       'kpnmmkru9038', 'exmvguwr2606', 'ucuadvqa7540', 'bcedixmj2523', 'venaavpt9323', 'dlkqqsld2324',
                       'tkhiowfh1984', 'taswpfmw2697'}

-- ตัวแปรสำหรับการทำงาน
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local GuiService = game:GetService("GuiService")
local VirtualInputManager = game:GetService("VirtualInputManager")

-- ตัวแปรสำหรับ tracking
local currentStep = 0
local currentStepReceiver = 0 -- ตัวแปรแยกสำหรับ receiver mode
local isTrading = false
local tradePartner = nil

-- ตัวแปรสำหรับตรวจสอบสถานะการเพิ่มไอเทม
local shroomAdded = false
local tokenAdded = false
local creatureAdded = false

-- ตัวแปรควบคุมการเรียก remote (ป้องกันการเรียกซ้อน)
local isRemoteBusy = false
local lastRemoteCallTime = 0

-- ตัวแปรสำหรับ state-based tracking (เพิ่มใหม่)
local receiverCreatureStartTime = 0
local receiverCreatureRequested = false
local receiverAcceptStartTime = 0
local receiverAcceptRequested = false

-- ตัวแปรสำหรับ receiver timeout (เพิ่มใหม่)
local lastTradeRequestTime = tick()
local RECEIVER_TIMEOUT = 300 -- 5 นาที (300 วินาที)

-- ตัวแปรสำหรับ sender state-based tracking
local senderShroomStartTime = 0
local senderShroomRequested = false
local senderTokenStartTime = 0
local senderTokenRequested = false
local senderCreatureStartTime = 0
local senderCreatureRequested = false
local senderAcceptStartTime = 0
local senderAcceptRequested = false

-- ตัวแปรป้องกันการทำงานพร้อมกัน
local isSenderMainActive = false
local isSenderReceiverActive = false

-- ตัวแปรสำหรับ timeout การรอเริ่มเทรดหลังส่งคำขอหา receiver
local SENDER_REQUEST_TIMEOUT = 200 -- วินาที
local lastSentTargetName = nil
local lastSentTargetIsReceiver = false
local lastSentTime = 0

-- ฟังก์ชันช่วยเหลือ
local function IsInList(name, list)
    for _, listName in ipairs(list) do
        if name == listName then
            return true
        end
    end
    return false
end

local function Clicked_Ui(path)
    local success, error = pcall(function()
        GuiService.SelectedObject = path
    end)

    if not success then
        warn("❌ เกิดข้อผิดพลาดในการเลือก UI: " .. tostring(error))
    end
end

local function Click_NOW()
    local success, error = pcall(function()
        VirtualInputManager:SendKeyEvent(true, 13, false, game)
        wait(0.1)
        VirtualInputManager:SendKeyEvent(false, 13, false, game)
        task.wait(2)
        Clicked_Ui(nil)
    end)

    if not success then
        warn("❌ เกิดข้อผิดพลาดในการกดปุ่ม: " .. tostring(error))
    end
end

-- ฟังก์ชันวาร์ปไปยังตำแหน่งที่กำหนด
local function WarpToLocation()
    local success, error = pcall(function()
        local character = LocalPlayer.Character
        if character then
            character:PivotTo(CFrame.new(Vector3.new(-2132.24, 490.66, 1106.83)))
            print("✅ วาร์ปไปยังตำแหน่งที่กำหนดแล้ว")
        end
    end)

    if not success then
        warn("❌ เกิดข้อผิดพลาดในการวาร์ป: " .. tostring(error))
    end
end

-- ฟังก์ชันหาคู่เทรดที่ว่าง
local function FindValidReceiver()
    local result = nil
    local success, error = pcall(function()
        -- ตรวจสอบ coins ก่อน
        local coinsValue = LocalPlayer.Data.Coins.Value
        if coinsValue <= 20 then
            print("💰 Coins ไม่เพียงพอ (" .. coinsValue .. " <= 20) ไม่ทำการเทรด")
            return nil
        end
        
        print("🔍 กำลังค้นหาคู่เทรดที่ว่าง...")

        -- ค้นหา receiver ที่ว่าง
        local validReceivers = {}
        local getPlayersSuccess = pcall(function()
            for _, player in pairs(Players:GetPlayers()) do
                if IsInList(player.Name, RECEIVER_LIST) then
                    local isAvailable = false
                    local tradingValue = nil
                    local checkSuccess = pcall(function()
                        if player and player:FindFirstChild("Settings") and player.Settings:FindFirstChild("Trading") then
                            tradingValue = player.Settings.Trading.Value
                            isAvailable = (tradingValue == false)
                        else
                            isAvailable = true
                            tradingValue = "unknown"
                        end
                    end)

                    if not checkSuccess then
                        print(
                            "⚠️ เกิดข้อผิดพลาดในการเช็คสถานะ " ..
                                player.Name .. " สมมติว่าว่าง...")
                        isAvailable = true
                        tradingValue = "error"
                    end

                    if isAvailable then
                        print("✅ พบ receiver ที่ว่าง: " .. player.Name .. " (Trading.Value = " ..
                                  tostring(tradingValue) .. ")")
                        table.insert(validReceivers, player)
                    else
                        print("❌ Receiver " .. player.Name ..
                                  " กำลังเทรดอยู่ (Trading.Value = " .. tostring(tradingValue) ..
                                  ")")
                    end
                end
            end
        end)

        if not getPlayersSuccess then
            print(
                "❌ เกิดข้อผิดพลาดในการดึงรายชื่อผู้เล่น")
            return nil
        end

        -- ถ้ามี receiver ว่าง ให้เลือกหนึ่งคน
        if #validReceivers > 0 then
            local selected = validReceivers[math.random(1, #validReceivers)]
            print("🎯 เลือก receiver: " .. selected.Name)
            result = selected
            return
        end

        -- ถ้าไม่มี receiver ว่าง ให้ค้นหา sender อื่นที่ว่าง
        print("ไม่มี receiver ว่าง กำลังค้นหา sender อื่น...")
        local validSenders = {}
        for _, player in pairs(Players:GetPlayers()) do
            if IsInList(player.Name, SENDER_LIST) and player.Name ~= LocalPlayer.Name then
                local isAvailable = false
                local tradingValue = nil
                pcall(function()
                    tradingValue = player.Settings.Trading.Value
                    isAvailable = (tradingValue == false)
                end)

                if isAvailable then
                    print("✅ พบ sender ที่ว่าง: " .. player.Name .. " (Trading.Value = " ..
                              tostring(tradingValue) .. ")")
                    table.insert(validSenders, player)
                else
                    print(
                        "❌ Sender " .. player.Name .. " กำลังเทรดอยู่ (Trading.Value = " ..
                            tostring(tradingValue) .. ")")
                end
            end
        end

        if #validSenders > 0 then
            local selected = validSenders[math.random(1, #validSenders)]
            print("🎯 เลือก sender เพื่อเทรดด้วย: " .. selected.Name)
            result = selected
            return
        end

        print("❌ ไม่พบคู่เทรดที่ว่าง")
    end)
    if not success then
        warn("❌ เกิดข้อผิดพลาดในฟังก์ชัน FindValidReceiver: " ..
                 tostring(error))
    end
    return result
end

-- ฟังก์ชันส่ง trade request
local function SendTradeRequest(receiverName)
    local success, error = pcall(function()
        local args = {"SendRequest", game:GetService("Players"):WaitForChild(receiverName)}
        game:GetService("Players").LocalPlayer:WaitForChild("Remotes"):WaitForChild("TradeRequestRemote"):FireServer(
            unpack(args))
        print("📤 ส่ง trade request ไปยัง " .. receiverName)
    end)

    if not success then
        warn("❌ เกิดข้อผิดพลาดในการส่ง trade request: " .. tostring(error))
        return false
    end

    return true
end

-- ฟังก์ชันหาผู้เล่น sender ที่ว่าง (ค้นหาเฉพาะ sender)
local function FindAvailableSender()
    local result = nil
    local success, error = pcall(function()
        print("🔍 กำลังค้นหา sender ที่ว่าง...")

        local validSenders = {}
        for _, player in pairs(Players:GetPlayers()) do
            if IsInList(player.Name, SENDER_LIST) and player.Name ~= LocalPlayer.Name then
                local isAvailable = false
                local tradingValue = nil
                pcall(function()
                    if player and player:FindFirstChild("Settings") and player.Settings:FindFirstChild("Trading") then
                        tradingValue = player.Settings.Trading.Value
                        isAvailable = (tradingValue == false)
                    else
                        isAvailable = true
                        tradingValue = "unknown"
                    end
                end)

                if isAvailable then
                    print("✅ พบ sender ที่ว่าง: " .. player.Name .. " (Trading.Value = " .. tostring(tradingValue) .. ")")
                    table.insert(validSenders, player)
                else
                    print("❌ Sender " .. player.Name .. " กำลังเทรดอยู่ (Trading.Value = " .. tostring(tradingValue) .. ")")
                end
            end
        end

        if #validSenders > 0 then
            local selected = validSenders[math.random(1, #validSenders)]
            print("🎯 เลือก sender: " .. selected.Name)
            result = selected
            return
        end

        print("❌ ไม่พบ sender ที่ว่าง")
    end)
    if not success then
        warn("❌ เกิดข้อผิดพลาดในฟังก์ชัน FindAvailableSender: " .. tostring(error))
    end
    return result
end

-- ฟังก์ชัน add shroom
local function AddShroom()
    local tradeGuiSafe = LocalPlayer.PlayerGui and LocalPlayer.PlayerGui:FindFirstChild("TradeGui")
    if not (tradeGuiSafe and tradeGuiSafe.Enabled) then
        print("❌ TradeGui ไม่เปิดใช้งาน")
        return false
    end

    local success, error = pcall(function()
        -- ตรวจสอบ coins ก่อน
        local coinsValue = LocalPlayer.Data.Coins.Value
        if coinsValue <= 20 then
            print("💰 Coins ไม่เพียงพอ (" .. coinsValue .. " <= 20) ไม่สามารถเพิ่ม shroom ได้")
            return false
        end
        
        local tradeGui = LocalPlayer.PlayerGui.TradeGui
        local containerFrame = tradeGui.ContainerFrame
        local theirsFrame = containerFrame.Theirs
        local displayNameLabel = theirsFrame.DisplayNameLabel
        local userNameLabel = displayNameLabel.UserNameLabel
        local opponentName = userNameLabel.Text

        opponentName = opponentName:gsub("@", "")
        local localPlayerName = LocalPlayer.Name

        local amount = coinsValue - 20
        if amount > 500000 then
            amount = 500000
        end
        if amount < 0 then
            amount = 0
        end

        local args = {"AddTradeItem", {
            Overwrite = true,
            ItemType = "Currency",
            Name = "Shooms",
            Amount = amount
        }}

        if not LocalPlayer.PlayerGui.TradeGui.Enabled then
            print("❌ TradeGui ถูกปิดระหว่าง AddShroom, reset currentStep")
            currentStep = 0
            return false
        end

        local remote1Name = localPlayerName .. "-" .. opponentName .. "TradeRemote"
        local remote1 = ReplicatedStorage:FindFirstChild("Remotes") and
                            ReplicatedStorage.Remotes:FindFirstChild(remote1Name)
        if not remote1 then
            print("❌ ไม่พบ remote1: " .. tostring(remote1Name))
            currentStep = 0
            return false
        end
        remote1:InvokeServer(unpack(args))
        print("⏳ รอ 3 วินาทีหลังใช้ remote1...")
        wait(3)

        local remote2Name = opponentName .. "-" .. localPlayerName .. "TradeRemote"
        local remote2 = ReplicatedStorage:FindFirstChild("Remotes") and
                            ReplicatedStorage.Remotes:FindFirstChild(remote2Name)
        if not remote2 then
            print("❌ ไม่พบ remote2: " .. tostring(remote2Name))
            currentStep = 0
            return false
        end
        remote2:InvokeServer(unpack(args))
        print("⏳ รอ 3 วินาทีหลังใช้ remote2...")
        wait(3)

        print("✅ เพิ่ม " .. amount .. " Shrooms ในการเทรดกับ " .. opponentName)
        return true
    end)

    if not success then
        warn("❌ เกิดข้อผิดพลาดในฟังก์ชัน AddShroom: " ..
                 tostring(error))
        currentStep = 0
        return false
    end

    return true
end

-- ฟังก์ชัน add token
local function AddToken()
    local tradeGuiSafe = LocalPlayer.PlayerGui and LocalPlayer.PlayerGui:FindFirstChild("TradeGui")
    if not (tradeGuiSafe and tradeGuiSafe.Enabled) then
        print("❌ TradeGui ไม่เปิดใช้งาน")
        return false
    end

    -- ตรวจสอบว่า remote กำลังใช้งานอยู่หรือไม่
    if isRemoteBusy then
        print("⚠️ Remote กำลังใช้งานอยู่ รอสักครู่...")
        return false
    end

    local tokenList = {'ChangeCreatureColorsToken', 'CreatureReviveToken', 'FullGrowToken', 'PartialGrowToken',
                       'FreeSpinToken', 'RandomStoredCreatureToken'}

    local success, error = pcall(function()
        local tradeGui = LocalPlayer.PlayerGui.TradeGui
        local containerFrame = tradeGui.ContainerFrame
        local theirsFrame = containerFrame.Theirs
        local displayNameLabel = theirsFrame.DisplayNameLabel
        local userNameLabel = displayNameLabel.UserNameLabel
        local opponentName = userNameLabel.Text

        opponentName = opponentName:gsub('@', '')
        local localPlayerName = LocalPlayer.Name

        -- ตั้งค่า remote กำลังใช้งาน
        isRemoteBusy = true

        for i, tokenName in ipairs(tokenList) do
            if not LocalPlayer.PlayerGui.TradeGui.Enabled then
                print("❌ TradeGui ถูกปิดระหว่าง AddToken, reset currentStep")
                isRemoteBusy = false
                currentStep = 0
                return false
            end

            local args = {'AddTradeItem', {
                Overwrite = true,
                ItemType = 'Tokens',
                Name = tokenName,
                Amount = 150
            }}

            local remoteName = localPlayerName .. '-' .. opponentName .. 'TradeRemote'
            local remote = ReplicatedStorage:FindFirstChild('Remotes') and
                               ReplicatedStorage.Remotes:FindFirstChild(remoteName)
            if not remote then
                print('❌ ไม่พบ remote: ' .. tostring(remoteName))
                isRemoteBusy = false
                currentStep = 0
                return false
            end

            print("📤 กำลังเพิ่ม " .. tokenName .. " (" .. i .. "/" .. #tokenList .. ")...")

            local remoteSuccess, remoteError = pcall(function()
                remote:InvokeServer(unpack(args))
            end)

            if not remoteSuccess then
                warn(
                    "❌ เกิดข้อผิดพลาดในการเรียก remote สำหรับ " ..
                        tokenName .. ": " .. tostring(remoteError))
                isRemoteBusy = false
                currentStep = 0
                return false
            end

            print('✅ เพิ่ม ' .. tokenName .. ' ในการเทรดกับ ' .. opponentName)

            -- รอ 3 วินาทีหลังใช้ remote
            print("⏳ รอ 3 วินาทีหลังใช้ remote สำหรับ " .. tokenName ..
                      "...")
            wait(3)
        end

        -- ปลดล็อค remote
        isRemoteBusy = false
        print('✅ เพิ่ม token ทั้งหมดเสร็จสิ้น')
        return true
    end)

    if not success then
        warn("❌ เกิดข้อผิดพลาดในฟังก์ชัน AddToken: " ..
                 tostring(error))
        isRemoteBusy = false
        currentStep = 0
        return false
    end

    return true
end

-- ฟังก์ชัน add creature สำหรับ Receiver แบบปลอดภัย
local function AddCreatureReceiver()
    local tradeGuiSafe = LocalPlayer.PlayerGui and LocalPlayer.PlayerGui:FindFirstChild("TradeGui")
    if not (tradeGuiSafe and tradeGuiSafe.Enabled) then
        print("❌ TradeGui ไม่เปิดใช้งาน")
        return false
    end

    -- ตรวจสอบว่า remote กำลังใช้งานอยู่หรือไม่
    if isRemoteBusy then
        print("⚠️ Remote กำลังใช้งานอยู่ รอสักครู่...")
        return false
    end

    local success, error = pcall(function()
        local Unlocks = LocalPlayer.Data and LocalPlayer.Data.Unlocks
        local creatureName = nil

        if LocalPlayer and LocalPlayer.Data and LocalPlayer.Data.Unlocks then
            for _, child in pairs(Unlocks:GetChildren()) do
                if not LocalPlayer.PlayerGui.TradeGui.Enabled then
                    print('❌ TradeGui ถูกปิดระหว่าง AddCreatureReceiver, reset currentStep')
                    currentStepReceiver = 0
                    return false
                end
                if child:IsA('ValueBase') and tonumber(child.Value) and tonumber(child.Value) > 0 then
                    if child.Name ~= "Vin'rou" and child.Name ~= 'Eulopii' then
                        creatureName = child.Name
                        break
                    end
                end
            end

            if not creatureName then
                warn('❌ ไม่พบ creature ที่ตรงเงื่อนไข')
                currentStepReceiver = 0
                return false
            end

            local theirLabel = LocalPlayer.PlayerGui and LocalPlayer.PlayerGui:FindFirstChild('TradeGui') and
                                   LocalPlayer.PlayerGui.TradeGui.ContainerFrame.Theirs.DisplayNameLabel.UserNameLabel

            if not theirLabel or not theirLabel.Text then
                warn('❌ ไม่พบชื่อฝ่ายตรงข้าม')
                currentStepReceiver = 0
                return false
            end

            local otherPlayerName = theirLabel.Text
            if string.sub(otherPlayerName, 1, 1) == '@' then
                otherPlayerName = string.sub(otherPlayerName, 2)
            end

            local remoteName = otherPlayerName .. '-' .. LocalPlayer.Name .. 'TradeRemote'
            local remotes = ReplicatedStorage:FindFirstChild('Remotes')
            if not remotes then
                print('❌ ไม่พบ Remotes folder')
                currentStepReceiver = 0
                return false
            end

            local remote = remotes:FindFirstChild(remoteName)
            if not remote then
                print('❌ ไม่พบ remote: ' .. tostring(remoteName))
                currentStepReceiver = 0
                return false
            end

            if not LocalPlayer.PlayerGui.TradeGui.Enabled then
                print('❌ TradeGui ถูกปิดระหว่าง AddCreatureReceiver, reset currentStep')
                currentStepReceiver = 0
                return false
            end

            -- ตรวจสอบเวลาที่ผ่านไปตั้งแต่ remote call ล่าสุด
            local timeSinceLastCall = tick() - lastRemoteCallTime
            if timeSinceLastCall < 3 then
                local waitTime = 3 - timeSinceLastCall
                print("⏳ รอ " .. string.format("%.1f", waitTime) ..
                          " วินาทีก่อนเรียก remote สำหรับ creature...")
                wait(waitTime)
            end

            -- ตั้งค่า remote กำลังใช้งาน
            isRemoteBusy = true
            lastRemoteCallTime = tick()

            local args = {'AddTradeItem', {
                Overwrite = true,
                ItemType = 'Creatures',
                Name = creatureName,
                Amount = 1
            }}

            print("📤 กำลังเพิ่ม creature: " .. creatureName .. "...")

            local remoteSuccess, remoteError = pcall(function()
                remote:InvokeServer(unpack(args))
            end)

            if not remoteSuccess then
                warn('❌ เกิดข้อผิดพลาดในการเรียก Remote: ' ..
                         tostring(remoteError))
                isRemoteBusy = false
                currentStepReceiver = 0
                return false
            else
                print('✅ เพิ่ม creature สำเร็จ!')
                lastRemoteCallTime = tick()

                -- รอ 3 วินาทีหลังใช้ remote
                print("⏳ รอ 3 วินาทีหลังใช้ remote สำหรับ creature...")
                wait(3)

                -- ปลดล็อค remote
                isRemoteBusy = false
                return true
            end
        else
            print('❌ ไม่สามารถเข้าถึง Data.Unlocks ได้')
            currentStepReceiver = 0
            return false
        end
    end)

    if not success then
        warn('❌ เกิดข้อผิดพลาดในฟังก์ชัน AddCreatureReceiver: ' ..
                 tostring(error))
        isRemoteBusy = false
        currentStepReceiver = 0
        return false
    end

    return true
end

-- ฟังก์ชัน add creature
local function AddCreature(isReceiver)
    local tradeGuiSafe = LocalPlayer.PlayerGui and LocalPlayer.PlayerGui:FindFirstChild("TradeGui")
    if not (tradeGuiSafe and tradeGuiSafe.Enabled) then
        print("❌ TradeGui ไม่เปิดใช้งาน")
        return false
    end

    -- ตรวจสอบว่า remote กำลังใช้งานอยู่หรือไม่
    if isRemoteBusy then
        print("⚠️ Remote กำลังใช้งานอยู่ รอสักครู่...")
        return false
    end

    local success, error = pcall(function()
        local Unlocks = LocalPlayer.Data and LocalPlayer.Data.Unlocks
        local creatureName = nil

        if LocalPlayer and LocalPlayer.Data and LocalPlayer.Data.Unlocks then
            for _, child in pairs(Unlocks:GetChildren()) do
                if not LocalPlayer.PlayerGui.TradeGui.Enabled then
                    print('❌ TradeGui ถูกปิดระหว่าง AddCreature, reset currentStep')
                    currentStep = 0
                    return false
                end
                if child:IsA('ValueBase') and tonumber(child.Value) and tonumber(child.Value) > 0 then
                    if child.Name ~= "Vin'rou" and child.Name ~= 'Eulopii' then
                        creatureName = child.Name
                        break
                    end
                end
            end

            if not creatureName then
                warn('❌ ไม่พบ creature ที่ตรงเงื่อนไข')
                currentStep = 0
                return false
            end

            local theirLabel = LocalPlayer.PlayerGui and LocalPlayer.PlayerGui:FindFirstChild('TradeGui') and
                                   LocalPlayer.PlayerGui.TradeGui.ContainerFrame.Theirs.DisplayNameLabel.UserNameLabel

            if not theirLabel or not theirLabel.Text then
                warn('❌ ไม่พบชื่อฝ่ายตรงข้าม')
                currentStep = 0
                return false
            end

            local otherPlayerName = theirLabel.Text
            if string.sub(otherPlayerName, 1, 1) == '@' then
                otherPlayerName = string.sub(otherPlayerName, 2)
            end

            local remoteName
            if isReceiver then
                remoteName = otherPlayerName .. '-' .. LocalPlayer.Name .. 'TradeRemote'
            else
                remoteName = LocalPlayer.Name .. '-' .. otherPlayerName .. 'TradeRemote'
            end
            local remote = ReplicatedStorage:FindFirstChild('Remotes') and
                               ReplicatedStorage.Remotes:FindFirstChild(remoteName)
            if not remote then
                print('❌ ไม่พบ remote: ' .. tostring(remoteName))
                currentStep = 0
                return false
            end

            if not LocalPlayer.PlayerGui.TradeGui.Enabled then
                print('❌ TradeGui ถูกปิดระหว่าง AddCreature, reset currentStep')
                currentStep = 0
                return false
            end

            -- ตรวจสอบเวลาที่ผ่านไปตั้งแต่ remote call ล่าสุด
            local timeSinceLastCall = tick() - lastRemoteCallTime
            if timeSinceLastCall < 3 then
                local waitTime = 3 - timeSinceLastCall
                print("⏳ รอ " .. string.format("%.1f", waitTime) ..
                          " วินาทีก่อนเรียก remote สำหรับ creature...")
                wait(waitTime)
            end

            -- ตั้งค่า remote กำลังใช้งาน
            isRemoteBusy = true
            lastRemoteCallTime = tick()

            local args = {'AddTradeItem', {
                Overwrite = true,
                ItemType = 'Creatures',
                Name = creatureName,
                Amount = 1
            }}

            print("📤 กำลังเพิ่ม creature: " .. creatureName .. "...")

            local remoteSuccess, remoteError = pcall(function()
                remote:InvokeServer(unpack(args))
            end)

            if not remoteSuccess then
                warn('❌ เกิดข้อผิดพลาดในการเรียก Remote: ' ..
                         tostring(remoteError))
                isRemoteBusy = false
                currentStep = 0
                return false
            else
                print('✅ เพิ่ม creature สำเร็จ!')
                lastRemoteCallTime = tick()

                -- รอ 3 วินาทีหลังใช้ remote
                print("⏳ รอ 3 วินาทีหลังใช้ remote สำหรับ creature...")
                wait(3)

                -- ปลดล็อค remote
                isRemoteBusy = false
                return true
            end
        else
            print('❌ ไม่สามารถเข้าถึง Data.Unlocks ได้')
            currentStep = 0
            return false
        end
    end)

    if not success then
        warn('❌ เกิดข้อผิดพลาดในฟังก์ชัน AddCreature: ' ..
                 tostring(error))
        isRemoteBusy = false
        currentStep = 0
        return false
    end

    return true
end

-- ฟังก์ชันกด accept สำหรับ Receiver แบบปลอดภัย
local function ClickAcceptReceiver()
    local success, error = pcall(function()
        if not LocalPlayer.PlayerGui.TradeGui.Enabled then
            print("❌ TradeGui ไม่เปิดใช้งาน")
            return false
        end

        -- ตรวจสอบว่า remote กำลังใช้งานอยู่หรือไม่
        if isRemoteBusy then
            print(
                "⚠️ Remote ยังใช้งานอยู่ ไม่สามารถกด accept ได้!")
            return false
        end

        local tradeGui = LocalPlayer.PlayerGui:FindFirstChild("TradeGui")
        if not tradeGui then
            print("❌ ไม่พบ TradeGui")
            return false
        end

        local containerFrame = tradeGui:FindFirstChild("ContainerFrame")
        if not containerFrame then
            print("❌ ไม่พบ ContainerFrame")
            return false
        end

        local acceptButton = containerFrame:FindFirstChild("AcceptButton")
        if not acceptButton then
            print("❌ ไม่พบ AcceptButton")
            return false
        end

        local upperLabel = acceptButton:FindFirstChild("UpperLabel")
        if not upperLabel then
            print("❌ ไม่พบ UpperLabel")
            return false
        end

        Clicked_Ui(upperLabel)
        task.wait(.1)
        Click_NOW()
        print("✅ กด accept แล้ว")
        return true
    end)

    if not success then
        warn("❌ เกิดข้อผิดพลาดในการกด accept: " .. tostring(error))
        return false
    end

    return true
end

-- ฟังก์ชันกด accept
local function ClickAccept()
    local success, error = pcall(function()
        if not LocalPlayer.PlayerGui.TradeGui.Enabled then
            print("❌ TradeGui ไม่เปิดใช้งาน")
            return false
        end

        -- ตรวจสอบว่า remote กำลังใช้งานอยู่หรือไม่
        if isRemoteBusy then
            print(
                "⚠️ Remote ยังใช้งานอยู่ ไม่สามารถกด accept ได้!")
            return false
        end

        Clicked_Ui(LocalPlayer.PlayerGui.TradeGui.ContainerFrame.AcceptButton.UpperLabel)
        task.wait(.1)
        Click_NOW()
        print("✅ กด accept แล้ว")
        return true
    end)

    if not success then
        warn("❌ เกิดข้อผิดพลาดในการกด accept: " .. tostring(error))
        return false
    end

    return true
end

-- ฟังก์ชันกด cancel
local function ClickCancel()
    local success, error = pcall(function()
        Clicked_Ui(LocalPlayer.PlayerGui.TradeGui.ContainerFrame.CancelButton.UpperLabel)
        task.wait(.1)
        Click_NOW()
        print("❌ ยกเลิกการเทรด")
    end)

    if not success then
        warn("❌ เกิดข้อผิดพลาดในการกด cancel: " .. tostring(error))
    end
end

-- ฟังก์ชันเช็คชื่อคู่เทรด
local function CheckTradePartner()
    local success, error = pcall(function()
        if not LocalPlayer.PlayerGui.TradeGui.Enabled then
            return false
        end

        local theirLabel = LocalPlayer.PlayerGui.TradeGui.ContainerFrame.Theirs.DisplayNameLabel.UserNameLabel
        if not theirLabel or not theirLabel.Text then
            return false
        end

        local opponentName = theirLabel.Text:gsub("@", "")

        -- เช็คว่าชื่อตรงกับในรายชื่อหรือไม่
        if IsInList(opponentName, RECEIVER_LIST) or IsInList(opponentName, SENDER_LIST) then
            print("✅ ชื่อคู่เทรดถูกต้อง: " .. opponentName)
            return true
        else
            print("❌ ชื่อคู่เทรดไม่ตรงกับรายชื่อ: " ..
                      opponentName)
            ClickCancel()
            return false
        end
    end)

    if not success then
        warn(
            "❌ เกิดข้อผิดพลาดในการเช็คชื่อคู่เทรด: " ..
                tostring(error))
        return false
    end

    return true
end

-- ฟังก์ชัน accept trade request สำหรับ Sender
local function AcceptTradeRequestForSender()
    local success, error = pcall(function()
        local requestsFrame = LocalPlayer.PlayerGui.RequestsGui.RequestsFrame.Other
        if not requestsFrame then
            return false
        end

        for _, child in pairs(requestsFrame:GetChildren()) do
            if string.find(child.Name, "^Trade") then
                local senderName = child.Name:sub(6) -- ตัด "Trade" ออก
                -- Sender สามารถรับ trade request จาก sender อื่นได้
                if IsInList(senderName, SENDER_LIST) then
                    print("✅ Sender พบ trade request จาก " .. senderName .. " กำลัง accept...")

                    -- อัปเดตเวลาสุดท้ายที่ได้รับ trade request (เพิ่มใหม่)
                    lastTradeRequestTime = tick()

                    Clicked_Ui(child.AcceptButton.UpperLabel)
                    task.wait(.1)
                    Click_NOW()
                    return true
                else
                    print("❌ Trade request จาก " .. senderName ..
                              " ไม่ตรงกับรายชื่อ กำลัง decline...")
                    Clicked_Ui(child.DeclineButton.UpperLabel)
                    task.wait(.1)
                    Click_NOW()
                end
            end
        end

        return false
    end)

    if not success then
        warn(
            "❌ เกิดข้อผิดพลาดในการ accept trade request สำหรับ Sender: " ..
                tostring(error))
        return false
    end

    return true
end

-- ฟังก์ชันยอมรับ trade request ผ่าน Remote โดยใช้ชื่อผู้ส่ง (รองรับหลายรูปแบบจาก remote spy)
local function AcceptTradeByRemote(senderName)
    local success, err = pcall(function()
        local args = {"AcceptRequest"}
        game:GetService("Players"):WaitForChild(senderName):WaitForChild("Remotes"):WaitForChild("TradeRequestRemote"):FireServer(unpack(args))
    end)
    if success then
        print("✅ ยอมรับ trade request ของ " .. tostring(senderName) .. " ผ่าน Remote สำเร็จ (รูปแบบ remote spy)")
        return true
    else
        warn("❌ ยอมรับ trade request ผ่าน Remote ไม่สำเร็จ: " .. tostring(err))
        return false
    end
end

-- ฟังก์ชัน accept trade request สำหรับ Receiver แบบปลอดภัย
local function AcceptTradeRequestReceiver()
    local success, error = pcall(function()
        local requestsGui = LocalPlayer.PlayerGui:FindFirstChild('RequestsGui')
        if not requestsGui then
            return false
        end

        local requestsFrame = requestsGui:FindFirstChild('RequestsFrame')
        if not requestsFrame then
            return false
        end

        local otherFrame = requestsFrame:FindFirstChild('Other')
        if not otherFrame then
            return false
        end

        for _, child in pairs(otherFrame:GetChildren()) do
            if string.find(child.Name, "^Trade") then
                local senderName = child.Name:sub(6) -- ตัด "Trade" ออก
                if IsInList(senderName, SENDER_LIST) then
                    print("✅ Receiver พบ trade request จาก " .. senderName .. " กำลัง accept ผ่าน Remote...")

                    -- อัปเดตเวลาสุดท้ายที่ได้รับ trade request (เพิ่มใหม่)
                    lastTradeRequestTime = tick()

                    -- พยายามยอมรับผ่าน Remote ก่อน ถ้าไม่สำเร็จ ค่อย fallback เป็น UI
                    local remoteAccepted = AcceptTradeByRemote(senderName)
                    if remoteAccepted then
                        return true
                    else
                        print("⚠️ Remote accept ล้มเหลว กำลังใช้ UI แทน...")
                        Clicked_Ui(child.AcceptButton.UpperLabel)
                        task.wait(.1)
                        Click_NOW()
                        return true
                    end
                else
                    print("❌ Trade request จาก " .. senderName ..
                              " ไม่ตรงกับรายชื่อ กำลัง decline...")
                    Clicked_Ui(child.DeclineButton.UpperLabel)
                    task.wait(.1)
                    Click_NOW()
                end
            end
        end

        return false
    end)

    if not success then
        warn(
            "❌ เกิดข้อผิดพลาดในการ accept trade request สำหรับ Receiver: " ..
                tostring(error))
        return false
    end

    return true
end

-- ฟังก์ชัน accept trade request สำหรับ Receiver
local function AcceptTradeRequest()
    local success, error = pcall(function()
        local requestsFrame = LocalPlayer.PlayerGui.RequestsGui.RequestsFrame.Other
        if not requestsFrame then
            return false
        end

        for _, child in pairs(requestsFrame:GetChildren()) do
            if string.find(child.Name, "^Trade") then
                local senderName = child.Name:sub(6) -- ตัด "Trade" ออก
                if IsInList(senderName, SENDER_LIST) then
                    print("✅ Receiver พบ trade request จาก " .. senderName .. " กำลัง accept ผ่าน Remote...")

                    -- อัปเดตเวลาสุดท้ายที่ได้รับ trade request (เพิ่มใหม่)
                    lastTradeRequestTime = tick()

                    -- พยายามยอมรับผ่าน Remote ก่อน ถ้าไม่สำเร็จ ค่อย fallback เป็น UI
                    local remoteAccepted = AcceptTradeByRemote(senderName)
                    if remoteAccepted then
                        return true
                    else
                        print("⚠️ Remote accept ล้มเหลว กำลังใช้ UI แทน...")
                        Clicked_Ui(child.AcceptButton.UpperLabel)
                        task.wait(.1)
                        Click_NOW()
                        return true
                    end
                else
                    print("❌ Trade request จาก " .. senderName ..
                              " ไม่ตรงกับรายชื่อ กำลัง decline...")
                    Clicked_Ui(child.DeclineButton.UpperLabel)
                    task.wait(.1)
                    Click_NOW()
                end
            end
        end

        return false
    end)

    if not success then
        warn(
            "❌ เกิดข้อผิดพลาดในการ accept trade request สำหรับ Receiver: " ..
                tostring(error))
        return false
    end

    return true
end

-- ฟังก์ชัน Coroutine สำหรับ Sender ที่รับ trade request
local function SenderReceiverCoroutine()
    while true do
        local success, error = pcall(function()
            -- ตรวจสอบ coins ก่อน
            local coinsValue = LocalPlayer.Data.Coins.Value
            if coinsValue <= 20 then
                print("💰 Coins ไม่เพียงพอ (" .. coinsValue .. " <= 20) SenderReceiver ไม่ทำงาน")
                wait(10) -- รอ 10 วินาทีก่อนตรวจสอบใหม่
                return
            end
            
            if not LocalPlayer.PlayerGui.TradeGui.Enabled then
                -- รอ trade request
                AcceptTradeRequestForSender()

                -- ตรวจสอบ timeout สำหรับ Sender ที่ทำงานแบบ Receiver (เพิ่มใหม่)
                local timeSinceLastRequest = tick() - lastTradeRequestTime
                local timeRemaining = RECEIVER_TIMEOUT - timeSinceLastRequest

                if timeSinceLastRequest >= RECEIVER_TIMEOUT then
                    print("⚠️ Sender (Receiver mode) ไม่ได้รับ trade request นาน " ..
                              string.format("%.1f", timeSinceLastRequest) .. " วินาที (เกิน " ..
                              RECEIVER_TIMEOUT .. " วินาที)")
                    print(
                        "🔄 กำลังเปลี่ยนเซิร์ฟเวอร์เพื่อหาคู่เทรดใหม่...")

                    local success, error = pcall(function()
                        local TeleportService = game:GetService("TeleportService")
                        TeleportService:Teleport(14119723130)
                    end)

                    if not success then
                        warn(
                            "❌ เกิดข้อผิดพลาดในการเปลี่ยนเซิร์ฟเวอร์: " ..
                                tostring(error))
                        print("🚪 กำลังออกจากเกม...")
                        game:Shutdown()
                    end
                    return
                else
                    -- แสดงสถานะเวลาที่เหลือทุก 30 วินาที
                    if math.floor(timeSinceLastRequest) % 30 == 0 or timeRemaining <= 60 then
                        print(
                            "⏰ Sender (Receiver mode) รอ trade request... เหลือเวลาอีก " ..
                                string.format("%.0f", timeRemaining) ..
                                " วินาทีก่อนเปลี่ยนเซิร์ฟเวอร์")
                    end
                end

                -- รีเซ็ตสถานะเมื่อไม่ได้เทรด
                receiverCreatureStartTime = 0
                receiverCreatureRequested = false
                receiverAcceptStartTime = 0
                receiverAcceptRequested = false
                currentStepReceiver = 0
                isSenderReceiverActive = false
                wait(2)
            else
                -- กำลังเทรดอยู่ (เมื่อเป็น receiver)
                -- ตรวจสอบว่ามี trade request หรือไม่
                local hasTradeRequest = false
                local requestsFrame = LocalPlayer.PlayerGui.RequestsGui.RequestsFrame.Other
                if requestsFrame then
                    for _, child in pairs(requestsFrame:GetChildren()) do
                        if string.find(child.Name, "^Trade") then
                            hasTradeRequest = true
                            break
                        end
                    end
                end

                -- ถ้ามี trade request ให้ override main sender
                if hasTradeRequest then
                    print("📩 พบ trade request กำลัง override Main Sender...")
                    isSenderMainActive = false
                end

                -- ตรวจสอบว่า main sender loop กำลังทำงานอยู่หรือไม่
                if isSenderMainActive then
                    print(
                        "⏸️ Main Sender กำลังทำงานอยู่ SenderReceiver รอสักครู่...")
                    wait(1)
                    return
                end

                if currentStepReceiver == 0 then
                    -- เช็คชื่อคู่เทรดก่อน
                    if CheckTradePartner() then
                        isSenderReceiverActive = true
                        currentStepReceiver = 1
                        print(
                            "🚀 Sender เริ่มขั้นตอนที่ 1: Add Creature (โหมด Receiver)")
                    else
                        wait(1)
                    end
                elseif currentStepReceiver == 1 then
                    -- Add Creature - ใช้ state-based tracking
                    if not receiverCreatureRequested then
                        -- ตรวจสอบว่า remote กำลังใช้งานอยู่หรือไม่
                        if isRemoteBusy then
                            print(
                                "⏳ Remote กำลังใช้งานอยู่ รอสักครู่...")
                            wait(1)
                        else
                            print("🚀 เริ่ม Add Creature...")
                            -- เริ่มทำ AddCreature แบบไม่รอผลลัพธ์
                            spawn(function()
                                AddCreature(true)
                            end)
                            receiverCreatureRequested = true
                            receiverCreatureStartTime = tick()
                            print("⏳ รอให้ Add Creature เสร็จ...")
                        end
                    else
                        -- ตรวจสอบว่าผ่านไป 5 วินาทีแล้วหรือยัง
                        local elapsedTime = tick() - receiverCreatureStartTime
                        if elapsedTime >= 5 then
                            currentStepReceiver = 2
                            print(
                                "   Sender เริ่มขั้นตอนที่ 2: Click Accept (โหมด Receiver)")
                        else
                            print("⏳ รอ Add Creature เสร็จ... (" ..
                                      string.format("%.1f", 5 - elapsedTime) .. " วินาที)")
                        end
                    end
                elseif currentStepReceiver == 2 then
                    -- Click Accept - ใช้ state-based tracking
                    if not receiverAcceptRequested then
                        print("🚀 เริ่ม Click Accept...")
                        -- เริ่มทำ ClickAccept แบบไม่รอผลลัพธ์
                        spawn(function()
                            ClickAccept()
                        end)
                        receiverAcceptRequested = true
                        receiverAcceptStartTime = tick()
                        print("⏳ รอให้ Click Accept เสร็จ...")
                    else
                        -- ตรวจสอบว่าผ่านไป 3 วินาทีแล้วหรือยัง
                        local elapsedTime = tick() - receiverAcceptStartTime
                        if elapsedTime >= 3 then
                            currentStepReceiver = 0
                            print("✅ Sender เทรดเสร็จสิ้น (โหมด Receiver)")
                            -- รีเซ็ตสถานะ
                            receiverCreatureStartTime = 0
                            receiverCreatureRequested = false
                            receiverAcceptStartTime = 0
                            receiverAcceptRequested = false
                            isSenderReceiverActive = false
                        else
                            print("⏳ รอ Click Accept เสร็จ... (" ..
                                      string.format("%.1f", 3 - elapsedTime) .. " วินาที)")
                        end
                    end
                end
                wait(1)
            end
        end)

        if not success then
            warn("❌ เกิดข้อผิดพลาดใน SenderReceiverCoroutine: " .. tostring(error))
            currentStepReceiver = 0
            -- รีเซ็ตสถานะ
            receiverCreatureStartTime = 0
            receiverCreatureRequested = false
            receiverAcceptStartTime = 0
            receiverAcceptRequested = false
            isSenderReceiverActive = false
            wait(5) -- รอ 5 วินาทีก่อนลองใหม่
        end
    end
end

function TradeStepHandlerSender(step)
    if not LocalPlayer.PlayerGui.TradeGui.Enabled then
        -- ยังไม่ได้เทรด
        if step ~= 0 then
            print(
                "Trade ถูกยกเลิกหรือจบกลางคัน กำลัง reset step...")
            -- รีเซ็ตสถานะการเพิ่มไอเทม
            shroomAdded = false
            tokenAdded = false
            creatureAdded = false
            -- รีเซ็ตสถานะ sender tracking
            senderShroomStartTime = 0
            senderShroomRequested = false
            senderTokenStartTime = 0
            senderTokenRequested = false
            senderCreatureStartTime = 0
            senderCreatureRequested = false
            senderAcceptStartTime = 0
            senderAcceptRequested = false
            isSenderMainActive = false
            -- รีเซ็ตสถานะการส่งคำขอค้าง
            lastSentTargetName = nil
            lastSentTargetIsReceiver = false
            lastSentTime = 0
            step = 0
        end

        -- ตรวจสอบว่า SenderReceiver กำลังทำงานอยู่หรือไม่
        if isSenderReceiverActive then
            print(
                "⏸️ SenderReceiver กำลังทำงานอยู่ Main Sender รอสักครู่...")
            return 0
        end

        -- ตรวจสอบ coins ก่อน
        local coinsValue = LocalPlayer.Data.Coins.Value
        if coinsValue <= 20 then
            print("💰 Coins ไม่เพียงพอ (" .. coinsValue .. " <= 20) ไม่ทำการเทรด")
            -- ถ้า coins ไม่เพียงพอ ให้ปลดล็อค main sender และรอ
            isSenderMainActive = false
            wait(10) -- รอ 10 วินาทีก่อนตรวจสอบใหม่
        else
            -- ถ้าส่งหา receiver ค้างไว้นานเกินกำหนด ให้ลองหา sender ที่ว่างแทน
            if lastSentTargetIsReceiver and lastSentTime > 0 then
                local elapsed = tick() - lastSentTime
                if elapsed >= SENDER_REQUEST_TIMEOUT then
                    print("⚠️ รอเริ่มเทรดกับ receiver (" .. tostring(lastSentTargetName) .. ") นานเกิน " .. SENDER_REQUEST_TIMEOUT .. " วินาที กำลังหา sender แทน...")
                    local fallbackSender = FindAvailableSender()
                    if fallbackSender then
                        SendTradeRequest(fallbackSender.Name)
                        lastSentTargetName = fallbackSender.Name
                        lastSentTargetIsReceiver = false
                        lastSentTime = tick()
                        return 0
                    else
                        -- ปรับเวลาเพื่อหลีกเลี่ยงการ spam ตรวจซ้ำทันที
                        lastSentTime = tick()
                    end
                end
            end

            local validPartner = FindValidReceiver()
            if validPartner then
                SendTradeRequest(validPartner.Name)
                -- บันทึกสถานะเป้าหมายล่าสุดที่ส่งคำขอ
                lastSentTargetName = validPartner.Name
                lastSentTargetIsReceiver = IsInList(validPartner.Name, RECEIVER_LIST)
                lastSentTime = tick()
            else
                -- ถ้าไม่มี partner ให้ปลดล็อค main sender
                isSenderMainActive = false
            end
        end
        return 0 -- reset step
    else
        -- กำลังเทรดอยู่
        -- เคลียร์สถานะการส่งคำขอค้างเมื่อเข้าสู่หน้าต่าง Trade จริง
        lastSentTargetName = nil
        lastSentTargetIsReceiver = false
        lastSentTime = 0
        if step == 0 then
            if CheckTradePartner() then
                print("🚀 เริ่มขั้นตอนที่ 1: Add Shroom")
                -- รีเซ็ตสถานะการเพิ่มไอเทมเมื่อเริ่มเทรดใหม่
                shroomAdded = false
                tokenAdded = false
                creatureAdded = false
                -- รีเซ็ตสถานะ sender tracking
                senderShroomStartTime = 0
                senderShroomRequested = false
                senderTokenStartTime = 0
                senderTokenRequested = false
                senderCreatureStartTime = 0
                senderCreatureRequested = false
                senderAcceptStartTime = 0
                senderAcceptRequested = false
                return 1
            end
        elseif step == 1 then
            if not LocalPlayer.PlayerGui.TradeGui.Enabled then
                print("TradeGui ถูกปิดระหว่าง AddShroom, reset step")
                return 0
            end
            -- Add Shroom - ใช้ state-based tracking
            if not senderShroomRequested then
                -- ตรวจสอบว่า remote กำลังใช้งานอยู่หรือไม่
                if isRemoteBusy then
                    print("⏳ Remote กำลังใช้งานอยู่ รอสักครู่...")
                    return 1
                else
                    print("🚀 เริ่ม Add Shroom...")
                    senderShroomRequested = true
                    senderShroomStartTime = tick()
                    isSenderMainActive = true -- ตั้ง active เมื่อเริ่มเทรดจริง
                    -- เรียก AddShroom แบบ synchronous และหยุด loop
                    print("⏸️ หยุด loop เพื่อรอ Add Shroom เสร็จ...")
                    local shroomSuccess = AddShroom()
                    if shroomSuccess then
                        shroomAdded = true
                        print("✅ Add Shroom เสร็จสิ้น")
                        print("🚀 เริ่มขั้นตอนที่ 2: Add Token")
                        return 2
                    else
                        print("❌ Add Shroom ล้มเหลว")
                        senderShroomRequested = false
                        isSenderMainActive = false
                        return 0
                    end
                end
            else
                -- ถ้า shroom ยังไม่เสร็จ แต่เวลาผ่านไปมากเกินไป
                local elapsedTime = tick() - senderShroomStartTime
                if elapsedTime >= 10 then
                    print(
                        "⚠️ Add Shroom ใช้เวลานานเกินไป กำลังข้ามไป step 2")
                    shroomAdded = true
                    return 2
                else
                    print("⏳ รอ Add Shroom เสร็จ... (" .. string.format("%.1f", 10 - elapsedTime) ..
                              " วินาที)")
                    return 1
                end
            end
        elseif step == 2 then
            if not LocalPlayer.PlayerGui.TradeGui.Enabled then
                print("TradeGui ถูกปิดระหว่าง AddToken, reset step")
                return 0
            end
            -- Add Token - ใช้ state-based tracking
            if not senderTokenRequested then
                -- ตรวจสอบว่า remote กำลังใช้งานอยู่หรือไม่
                if isRemoteBusy then
                    print("⏳ Remote กำลังใช้งานอยู่ รอสักครู่...")
                    return 2
                else
                    print("🚀 เริ่ม Add Token...")
                    senderTokenRequested = true
                    senderTokenStartTime = tick()
                    -- เรียก AddToken แบบ synchronous และหยุด loop
                    print("⏸️ หยุด loop เพื่อรอ Add Token เสร็จ...")
                    local tokenSuccess = AddToken()
                    if tokenSuccess then
                        tokenAdded = true
                        print("✅ Add Token เสร็จสิ้น")
                        print("🚀 เริ่มขั้นตอนที่ 3: Add Creature")
                        return 3
                    else
                        print("❌ Add Token ล้มเหลว")
                        senderTokenRequested = false
                        return 0
                    end
                end
            else
                -- ถ้า token ยังไม่เสร็จ แต่เวลาผ่านไปมากเกินไป
                local elapsedTime = tick() - senderTokenStartTime
                if elapsedTime >= 30 then
                    print(
                        "⚠️ Add Token ใช้เวลานานเกินไป กำลังข้ามไป step 3")
                    tokenAdded = true
                    return 3
                else
                    print("⏳ รอ Add Token เสร็จ... (" .. string.format("%.1f", 30 - elapsedTime) ..
                              " วินาที)")
                    return 2
                end
            end
        elseif step == 3 then
            if not LocalPlayer.PlayerGui.TradeGui.Enabled then
                print("TradeGui ถูกปิดระหว่าง AddCreature, reset step")
                return 0
            end
            -- Add Creature - ใช้ state-based tracking
            if not senderCreatureRequested then
                -- ตรวจสอบว่า remote กำลังใช้งานอยู่หรือไม่
                if isRemoteBusy then
                    print("⏳ Remote กำลังใช้งานอยู่ รอสักครู่...")
                    return 3
                else
                    print("🚀 เริ่ม Add Creature...")
                    senderCreatureRequested = true
                    senderCreatureStartTime = tick()
                    -- เรียก AddCreature แบบ synchronous และหยุด loop
                    print("⏸️ หยุด loop เพื่อรอ Add Creature เสร็จ...")
                    local creatureSuccess = AddCreature(false)
                    if creatureSuccess then
                        creatureAdded = true
                        print("✅ Add Creature เสร็จสิ้น")
                        print("🚀 เริ่มขั้นตอนที่ 4: Click Accept")
                        return 4
                    else
                        print("❌ Add Creature ล้มเหลว")
                        senderCreatureRequested = false
                        return 0
                    end
                end
            else
                -- ถ้า creature ยังไม่เสร็จ แต่เวลาผ่านไปมากเกินไป
                local elapsedTime = tick() - senderCreatureStartTime
                if elapsedTime >= 10 then
                    print(
                        "⚠️ Add Creature ใช้เวลานานเกินไป กำลังข้ามไป step 4")
                    creatureAdded = true
                    return 4
                else
                    print("⏳ รอ Add Creature เสร็จ... (" .. string.format("%.1f", 10 - elapsedTime) ..
                              " วินาที)")
                    return 3
                end
            end
        elseif step == 4 then
            if not LocalPlayer.PlayerGui.TradeGui.Enabled then
                print("TradeGui ถูกปิดระหว่าง ClickAccept, reset step")
                return 0
            end
            -- Click Accept - ใช้ state-based tracking
            if not senderAcceptRequested then
                -- ตรวจสอบว่าทุกขั้นตอนเสร็จสิ้นแล้ว
                if shroomAdded and tokenAdded and creatureAdded then
                    print("🔍 ตรวจสอบสถานะ: Shroom=" .. tostring(shroomAdded) .. ", Token=" ..
                              tostring(tokenAdded) .. ", Creature=" .. tostring(creatureAdded))

                    -- ตรวจสอบว่า remote ยังใช้งานอยู่หรือไม่
                    if isRemoteBusy then
                        print(
                            "⚠️ Remote ยังใช้งานอยู่ ไม่สามารถกด accept ได้! รอสักครู่...")
                        return 4 -- ยังคงอยู่ใน step 4
                    end
                    print("🚀 เริ่ม Click Accept...")
                    senderAcceptRequested = true
                    senderAcceptStartTime = tick()
                    -- เรียก ClickAccept แบบ synchronous และหยุด loop
                    print("⏸️ หยุด loop เพื่อรอ Click Accept เสร็จ...")
                    local acceptSuccess = ClickAccept()
                    if acceptSuccess then
                        print("✅ เทรดเสร็จสิ้น")
                        -- รีเซ็ตสถานะการเพิ่มไอเทม
                        shroomAdded = false
                        tokenAdded = false
                        creatureAdded = false
                        -- รีเซ็ตสถานะ sender tracking
                        senderShroomStartTime = 0
                        senderShroomRequested = false
                        senderTokenStartTime = 0
                        senderTokenRequested = false
                        senderCreatureStartTime = 0
                        senderCreatureRequested = false
                        senderAcceptStartTime = 0
                        senderAcceptRequested = false
                        isSenderMainActive = false
                        return 0
                    else
                        print("❌ Click Accept ล้มเหลว")
                        senderAcceptRequested = false
                        return 0
                    end
                else
                    print(
                        "⚠️ ยังมีขั้นตอนที่ยังไม่เสร็จ: Shroom=" ..
                            tostring(shroomAdded) .. ", Token=" .. tostring(tokenAdded) .. ", Creature=" ..
                            tostring(creatureAdded))
                    -- กลับไปทำขั้นตอนที่ยังไม่เสร็จ
                    if not shroomAdded then
                        print("🔄 กลับไปทำ Add Shroom")
                        return 1
                    elseif not tokenAdded then
                        print("🔄 กลับไปทำ Add Token")
                        return 2
                    elseif not creatureAdded then
                        print("🔄 กลับไปทำ Add Creature")
                        return 3
                    end
                end
            else
                -- ถ้า accept ยังไม่เสร็จ แต่เวลาผ่านไปมากเกินไป
                local elapsedTime = tick() - senderAcceptStartTime
                if elapsedTime >= 5 then
                    print(
                        "⚠️ Click Accept ใช้เวลานานเกินไป กำลังจบเทรด")
                    print("✅ เทรดเสร็จสิ้น")
                    -- รีเซ็ตสถานะการเพิ่มไอเทม
                    shroomAdded = false
                    tokenAdded = false
                    creatureAdded = false
                    -- รีเซ็ตสถานะ sender tracking
                    senderShroomStartTime = 0
                    senderShroomRequested = false
                    senderTokenStartTime = 0
                    senderTokenRequested = false
                    senderCreatureStartTime = 0
                    senderCreatureRequested = false
                    senderAcceptStartTime = 0
                    senderAcceptRequested = false
                    isSenderMainActive = false
                    return 0
                else
                    print("⏳ รอ Click Accept เสร็จ... (" .. string.format("%.1f", 5 - elapsedTime) ..
                              " วินาที)")
                    return 4
                end
            end
        end
    end
    return step
end

-- เรียกใช้งานแบบ timer (ทุก 1 วินาที)
local function StartSenderStepLoop()
    spawn(function()
        while true do
            local success, err = pcall(function()
                local previousStep = currentStep
                currentStep = TradeStepHandlerSender(currentStep)

                -- ถ้า step เปลี่ยน แสดงว่าขั้นตอนเสร็จแล้ว
                if previousStep ~= currentStep then
                    print("🔄 ขั้นตอนเปลี่ยนจาก " .. previousStep ..
                              " เป็น " .. currentStep)
                end
            end)
            if not success then
                warn("❌ เกิดข้อผิดพลาดใน TradeStepHandlerSender: " .. tostring(err))
                currentStep = 0
                -- รีเซ็ตสถานะ sender tracking
                senderShroomStartTime = 0
                senderShroomRequested = false
                senderTokenStartTime = 0
                senderTokenRequested = false
                senderCreatureStartTime = 0
                senderCreatureRequested = false
                senderAcceptStartTime = 0
                senderAcceptRequested = false
                isSenderMainActive = false
            end

            -- รอ 1 วินาทีแล้ววนใหม่
            wait(1)
        end
    end)
end

-- Coroutine สำหรับ Receiver แบบปลอดภัย
local function ReceiverCoroutine()
    while true do
        local success, error = pcall(function()
            -- ตรวจสอบ coins ก่อน
            local coinsValue = LocalPlayer.Data.Coins.Value
            if coinsValue <= 20 then
                print("💰 Coins ไม่เพียงพอ (" .. coinsValue .. " <= 20) Receiver ไม่ทำงาน")
                wait(10) -- รอ 10 วินาทีก่อนตรวจสอบใหม่
                return
            end
            
            -- ตรวจสอบ TradeGui อย่างปลอดภัย
            local tradeGuiEnabled = false
            local tradeGui = LocalPlayer.PlayerGui:FindFirstChild("TradeGui")
            if tradeGui then
                tradeGuiEnabled = tradeGui.Enabled
            end

            if not tradeGuiEnabled then
                -- รอ trade request
                AcceptTradeRequestReceiver()

                -- ตรวจสอบ timeout (เพิ่มใหม่)
                local timeSinceLastRequest = tick() - lastTradeRequestTime
                local timeRemaining = RECEIVER_TIMEOUT - timeSinceLastRequest

                if timeSinceLastRequest >= RECEIVER_TIMEOUT then
                    print("⚠️ Receiver ไม่ได้รับ trade request นาน " ..
                              string.format("%.1f", timeSinceLastRequest) .. " วินาที (เกิน " ..
                              RECEIVER_TIMEOUT .. " วินาที)")
                    print(
                        "🔄 กำลังเปลี่ยนเซิร์ฟเวอร์เพื่อหาคู่เทรดใหม่...")

                    local success, error = pcall(function()
                        local TeleportService = game:GetService("TeleportService")
                        TeleportService:Teleport(14119723130)
                    end)

                    if not success then
                        warn(
                            "❌ เกิดข้อผิดพลาดในการเปลี่ยนเซิร์ฟเวอร์: " ..
                                tostring(error))
                        print("🚪 กำลังออกจากเกม...")
                        game:Shutdown()
                    end
                    return
                else
                    -- แสดงสถานะเวลาที่เหลือทุก 30 วินาที
                    if math.floor(timeSinceLastRequest) % 30 == 0 or timeRemaining <= 60 then
                        print("⏰ Receiver รอ trade request... เหลือเวลาอีก " ..
                                  string.format("%.0f", timeRemaining) ..
                                  " วินาทีก่อนเปลี่ยนเซิร์ฟเวอร์")
                    end
                end

                -- รีเซ็ตสถานะเมื่อไม่ได้เทรด
                receiverCreatureStartTime = 0
                receiverCreatureRequested = false
                receiverAcceptStartTime = 0
                receiverAcceptRequested = false
                currentStepReceiver = 0
                wait(2)
            else
                -- กำลังเทรดอยู่
                if currentStepReceiver == 0 then
                    -- เช็คชื่อคู่เทรดก่อน
                    if CheckTradePartner() then
                        currentStepReceiver = 1
                        print("🚀 Receiver เริ่มขั้นตอนที่ 1: Add Creature")
                        -- รีเซ็ตสถานะก่อนเริ่มใหม่
                        receiverCreatureStartTime = 0
                        receiverCreatureRequested = false
                        receiverAcceptStartTime = 0
                        receiverAcceptRequested = false
                    else
                        wait(1)
                    end
                elseif currentStepReceiver == 1 then
                    -- Add Creature - ใช้ state-based tracking แบบปรับปรุง
                    if not receiverCreatureRequested then
                        -- ตรวจสอบว่า remote กำลังใช้งานอยู่หรือไม่
                        if isRemoteBusy then
                            print(
                                "⏳ Receiver: Remote กำลังใช้งานอยู่ รอสักครู่...")
                            wait(1)
                        else
                            print("🚀 Receiver เริ่ม Add Creature...")
                            receiverCreatureRequested = true
                            receiverCreatureStartTime = tick()

                            -- เรียก AddCreatureReceiver แบบ synchronous พร้อม error handling
                            local creatureSuccess = false
                            local attemptSuccess, attemptError = pcall(function()
                                creatureSuccess = AddCreatureReceiver()
                            end)

                            if attemptSuccess and creatureSuccess then
                                print("✅ Receiver Add Creature เสร็จสิ้น")
                                currentStepReceiver = 2
                                print("🚀 Receiver เริ่มขั้นตอนที่ 2: Click Accept")
                            else
                                warn("❌ Receiver Add Creature ล้มเหลว: " .. tostring(attemptError))
                                -- รีเซ็ตเพื่อลองใหม่
                                receiverCreatureRequested = false
                                receiverCreatureStartTime = 0
                                wait(2) -- รอก่อนลองใหม่
                            end
                        end
                    else
                        -- ตรวจสอบว่าผ่านไป 10 วินาทีแล้วหรือยัง (เพิ่มเวลา)
                        local elapsedTime = tick() - receiverCreatureStartTime
                        if elapsedTime >= 10 then
                            print(
                                "⚠️ Receiver Add Creature ใช้เวลานานเกินไป กำลังข้ามไป step 2")
                            currentStepReceiver = 2
                            print("🚀 Receiver เริ่มขั้นตอนที่ 2: Click Accept")
                        else
                            print("⏳ Receiver รอ Add Creature เสร็จ... (" ..
                                      string.format("%.1f", 10 - elapsedTime) .. " วินาที)")
                        end
                    end
                elseif currentStepReceiver == 2 then
                    -- Click Accept - ใช้ state-based tracking แบบปรับปรุง
                    if not receiverAcceptRequested then
                        -- ตรวจสอบว่า remote ยังใช้งานอยู่หรือไม่
                        if isRemoteBusy then
                            print(
                                "⚠️ Receiver: Remote ยังใช้งานอยู่ ไม่สามารถกด accept ได้! รอสักครู่...")
                            wait(1)
                        else
                            print("🚀 Receiver เริ่ม Click Accept...")
                            receiverAcceptRequested = true
                            receiverAcceptStartTime = tick()

                            -- เรียก ClickAcceptReceiver แบบ synchronous พร้อม error handling
                            local acceptSuccess = false
                            local attemptSuccess, attemptError = pcall(function()
                                acceptSuccess = ClickAcceptReceiver()
                            end)

                            if attemptSuccess and acceptSuccess then
                                print("✅ Receiver เทรดเสร็จสิ้น")
                                currentStepReceiver = 0
                                -- รีเซ็ตสถานะ
                                receiverCreatureStartTime = 0
                                receiverCreatureRequested = false
                                receiverAcceptStartTime = 0
                                receiverAcceptRequested = false
                            else
                                warn("❌ Receiver Click Accept ล้มเหลว: " .. tostring(attemptError))
                                -- รีเซ็ตเพื่อลองใหม่
                                receiverAcceptRequested = false
                                receiverAcceptStartTime = 0
                                wait(2) -- รอก่อนลองใหม่
                            end
                        end
                    else
                        -- ตรวจสอบว่าผ่านไป 5 วินาทีแล้วหรือยัง (เพิ่มเวลา)
                        local elapsedTime = tick() - receiverAcceptStartTime
                        if elapsedTime >= 5 then
                            print(
                                "⚠️ Receiver Click Accept ใช้เวลานานเกินไป กำลังจบเทรด")
                            print("✅ Receiver เทรดเสร็จสิ้น")
                            currentStepReceiver = 0
                            -- รีเซ็ตสถานะ
                            receiverCreatureStartTime = 0
                            receiverCreatureRequested = false
                            receiverAcceptStartTime = 0
                            receiverAcceptRequested = false
                        else
                            print("⏳ Receiver รอ Click Accept เสร็จ... (" ..
                                      string.format("%.1f", 5 - elapsedTime) .. " วินาที)")
                        end
                    end
                end
                wait(1)
            end
        end)

        if not success then
            warn("❌ เกิดข้อผิดพลาดใน ReceiverCoroutine: " .. tostring(error))
            currentStepReceiver = 0
            -- รีเซ็ตสถานะ
            receiverCreatureStartTime = 0
            receiverCreatureRequested = false
            receiverAcceptStartTime = 0
            receiverAcceptRequested = false
            wait(5) -- รอ 5 วินาทีก่อนลองใหม่
        end
    end
end

-- Coroutine ปิดหน้าต่าง CreatureInventoryFrame อัตโนมัติ (ทำงานเบื้องหลังตลอดเวลา)
local function InventoryCloserCoroutine()
    spawn(function()
        while true do
            local success, error = pcall(function()
                local playerGui = LocalPlayer and LocalPlayer.PlayerGui
                if not playerGui then return end

                local tradeHudGui = playerGui:FindFirstChild("TradeHUDGui")
                if not tradeHudGui then return end

                local bottomFrame = tradeHudGui:FindFirstChild("BottomFrame")
                if not bottomFrame then return end

                local creatureInventoryFrame = bottomFrame:FindFirstChild("CreatureInventoryFrame")
                if not creatureInventoryFrame then return end

                if creatureInventoryFrame.Visible == true then
                    local closeButton = creatureInventoryFrame:FindFirstChild("CloseButton")
                    local upperLabel = closeButton and closeButton:FindFirstChild("UpperLabel")
                    if upperLabel then
                        local safetyCounter = 0
                        while creatureInventoryFrame.Visible == true and safetyCounter < 30 do
                            Clicked_Ui(upperLabel)
                            task.wait(0.1)
                            Click_NOW()
                            task.wait(0.2)
                            safetyCounter = safetyCounter + 1
                        end
                    end
                end
            end)
            if not success then
                warn("❌ เกิดข้อผิดพลาดใน InventoryCloserCoroutine: " .. tostring(error))
            end
            wait(0.5)
        end
    end)
end

-- ฟังก์ชันหลัก
local function Main()
    local success, error = pcall(function()
        print("🎮 เริ่มต้นสคริปต์ Trade")

        -- วาร์ปไปยังตำแหน่งที่กำหนด
        WarpToLocation()

        -- เริ่ม coroutine ปิด CreatureInventoryFrame อัตโนมัติ
        InventoryCloserCoroutine()

        -- ตรวจสอบว่าเป็น Sender หรือ Receiver
        local isSender = IsInList(LocalPlayer.Name, SENDER_LIST)
        local isReceiver = IsInList(LocalPlayer.Name, RECEIVER_LIST)

        if isSender then
            print("👤 ทำงานในโหมด Sender")
            -- รีเซ็ตเวลาเริ่มต้นสำหรับ sender (สำหรับโหมด receiver) (เพิ่มใหม่)
            lastTradeRequestTime = tick()
            StartSenderStepLoop()
            -- เพิ่มการทำงานแบบ Receiver สำหรับ Sender
            coroutine.wrap(SenderReceiverCoroutine)()
        elseif isReceiver then
            print("👤 ทำงานในโหมด Receiver")
            -- รีเซ็ตเวลาเริ่มต้นสำหรับ receiver (เพิ่มใหม่)
            lastTradeRequestTime = tick()
            coroutine.wrap(ReceiverCoroutine)()
        else
            print("❌ ชื่อผู้เล่นไม่ตรงกับรายชื่อใดๆ")
        end
    end)

    if not success then
        warn("❌ เกิดข้อผิดพลาดในฟังก์ชันหลัก: " ..
                 tostring(error))
        -- ลองรันใหม่หลังจาก 10 วินาที
        wait(10)
        Main()
    end
end

-- เริ่มต้นสคริปต์
Main()
